#!/usr/bin/env bqn
âŸ¨Input,TW, MDSlashâŸ© â† â€¢Import "../../utils/utils.bqn"
l â† >â€¢FLines 2024â€¿4 Input â€¢args

SuperFind â† { pğ•Šsrc:
  cu â† '.'âŠ¸â‰ âŠ¸/ â·âˆ¾â¥ŠÂ¨p # unique characters
  
  pk â† ((â‰ cu) (âŠ¢-+âŸœ1Ã—=) cuâŠ¸âŠ)Â¨ p     # pattern key: index in cu for each char; Â¯1 for '.'
  cw â† pk âŠ”â—‹(âˆ¾â¥ŠÂ¨) (â†•â‰ pk) â‹ˆÂ¨Â¨ â†•âˆ˜â‰¢Â¨ pk # where each character from cu is; list of lists of âŸ¨pattern index, yâ€¿xâŸ©
  
  shv â† â†‘ âŸ¨âŒˆÂ´â‰ Â¨p, 1âŠ‘â‰¢srcâŸ©â¥Š0 # matrices of zeroes to shift in
  
  rm â† 1Â¨ pk # result masks
  cu { # for each unique character:
    riâ€¿ms â† <Ë˜â‰>ğ•©     # indices in result, mask shift
    i â† âŠms           # indices in unique shifts
    msf â† (âˆŠi)/ms     # the unique shifts
    msyâ€¿msx â† <Ë˜â‰>msf # their y/x
    ri {rmâˆ§âŸœğ•©âŒ¾(ğ•¨âŠ¸âŠ‘)â†©â‹„1}Â¨ iâŠ(msyâŠshv) Â«Â¨ Â«Ë˜âŸmsx ğ•¨=src # shift the source compared to the current character, and the masks in rm by it
  }Â¨ cw
  rm
}

p1 â† âŒ½âˆ˜â‰âŸ(â†•4) â‰"XMAS"
p1âˆ¾â†© {âŒ½Ë˜Â¨âŠ¸âˆ¾ âŒ½âŠ¸â‹ˆ ğ•©} 4â€¿4â¥Šâˆ¾âˆ¾âŸœ"...."Â¨ "XMAS"

p2 â† âŒ½âˆ˜â‰âŸ(â†•4) ["M.S",".A.","M.S"]

â€¢ShowÂ¨ +Â´Â¨ (â‰ p1)(â†‘â‹ˆâ†“) +Â´âˆ˜â¥ŠÂ¨ (p1âˆ¾p2) SuperFind l
# running the two parts separately (slightly slower):
# â€¢Show +Â´ +Â´âˆ˜â¥ŠÂ¨ p1 SuperFind l
# â€¢Show +Â´ +Â´âˆ˜â¥ŠÂ¨ p2 SuperFind l
