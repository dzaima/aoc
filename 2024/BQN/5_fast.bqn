#!/usr/bin/env bqn
âŸ¨Ints, SplitF, InputâŸ© â† â€¢Import "../../utils/utils.bqn"
bytes â† â€¢file.MapBytes 2024â€¿5 Input â€¢args

nw â† 1+ âŠ‘bytesâŠ'|' # number width, plus 1
sep â† â‹ˆâ¼/ (@â€¿@+10) â· bytes # index of the the two newlines

Nums â† {(1âŠ¸âŠË˜ + 10Ã—0âŠ¸âŠË˜) '0'-Ëœâˆ˜â€¿nwâ¥Šğ•©} # parse an nwÃ—n string into n numbers, ignoring the last char of each

a â† âˆ˜â€¿2â¥Š Nums (1+sep)â†‘bytes # parse the first section, ordering rules

b0 â† (2+sep)â†“bytes     # the second section
bw â† 3Ã·Ëœ-âŸœÂ» /0âˆ¾b0=@+10 # number of pages in each each line: deltas between newlines, div 3
b â† (/bw) âŠ” Nums b0    # parse the numbers, group into lines

n â† 1+âŒˆÂ´â¥Ša                             # number of nodes
ma â† <Ë˜ 1Â¨âŒ¾((+Ënâ€¿1Ã—â‰a)âŠâ¥Š) nâ€¿nâ¥Š0        # build adjacency matrix
s â† {ğ•©âŠËœ â‹ +Â´ ğ•©âŠ¸âŠÂ¨ ğ•©âŠma}Â¨ b            # sort each page list by how many other pages in the list it's adjacent to
(â€¢Show +Â´)Â¨ (2âˆ¾Ëœsâ‰¢Â¨b) âŠ” {ğ•©âŠ‘ËœâŒŠ2Ã·Ëœâ‰ ğ•©}Â¨ s # extract middle of each sorted list, group by equality to the original, sum & output each
