#!/usr/bin/env bqn
âŸ¨Ints, InputâŸ© â† â€¢Import "../../utils/utils.bqn"
p â† Ints 4âŠ‘â€¢FLines 2024â€¿17 Input 1â†“â€¢args
âŸ¨newreplâŸ© â† â€¢Import âŠ‘â€¢args # bqn-smt/bitwuzla.bqn (or cvc5.bqn or z3.bqn) - https://codeberg.org/dzaima/bqn-smt

r â† Newrepl @

smt â† r.REPLExec "{
  Run â† {pğ•Šr:
    outs â† âŸ¨âŸ©
    jleft â† â‰ p
    req â† true
    Step â† {
      opcodeâ€¿lit â† 2â†‘ğ•©â†“p
      combo â† {ğ•©â‰¤3? ğ•©; 7: '!'; (ğ•©-4)âŠ‘r} lit
      ipâ†opcodeâ—¶âŸ¨
        {r((âŠ‘r) Â»_u combo)âŒ¾(  âŠ‘)â†© â‹„ ğ•©} # adv
        {r (lit Xor âŠ¢)âŒ¾(1âŠ¸âŠ‘)â†© â‹„ ğ•©}     # bxl
        {r (7 âˆ§ combo)âŒ¾(1âŠ¸âŠ‘)â†© â‹„ ğ•©}     # bst
        { # jnz
          jleft-â†© 1
          stay â† jleftâ‰¤0
          reqâˆ§â†© stay = 0=âŠ‘r
          stay? ğ•©; lit
        }
        {r ((2âŠ‘r) Xor âŠ¢)âŒ¾(1âŠ¸âŠ‘)â†© â‹„ ğ•©}   # bxc
        {outsâˆ¾â†©7âˆ§ comboâ‹„ğ•©}             # out
        {r((âŠ‘r) Â»_u combo)âŒ¾(1âŠ¸âŠ‘)â†© â‹„ ğ•©} # bdv
        {r((âŠ‘r) Â»_u combo)âŒ¾(2âŠ¸âŠ‘)â†© â‹„ ğ•©} # cdv
      âŸ© ğ•©+2
      ip
    }
    Stepâ€¢_while_{ğ•©â‰ â‰ p} 0
    reqâ€¿outs
  }
  
  { ğ•Š p:
    _do â† { ğ”½_ğ•£ğ•©:
      a â† I64@
      reqâ€¿outs â† p Run âŸ¨a, 0i64, 0i64âŸ©
      Sat req âˆ§ (ğ”½ a) âˆ§Â´ p = outs?
        FindToBQN a
      ;
        @
    }
    
    1âŠ‘{@â‰¢râ†<_uâŸœğ•© _do @? 1â€¿r; 0â‹ˆğ•©}âˆ˜(1âŠ¸âŠ‘)â€¢_while_âŠ‘ 1â‹ˆ10+1 _do @
  }
}"

â€¢Show Smt p