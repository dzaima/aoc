#!/usr/bin/env bqn
âŸ¨SplitF, _underSelect_, Select, MDSlash, MDSlashI, InputâŸ© â† â€¢Import "../../utils/utils.bqn"
aâ€¿b â† âŸ¨âŸ©SplitF â€¢FLines 2024â€¿15 Input â€¢args
a >â†©
b âˆ¾â†©

Score â† {+Â´ +Â´Â¨ 100â€¿1 Ã— MDSlashI ð•¨=ð•©}

# part 1
{
  c â† a
  yâ€¿x â† â‹ˆâ¼MDSlash c='@'
  c '.'âŒ¾(yâ€¿xâŠ¸âŠ‘)â†©
  ds â† âŸ¨0â€¿1,1â€¿0,0â€¿Â¯1,Â¯1â€¿0âŸ©
  sh â† â‰¢c
  c â†© c {
    d â† âŠ‘">v<^"âŠð•¨
    {
      (kâ†âŠ‘ð•©âŠ'.') < âŠ‘ð•©âŠ'#'?
        yâ€¿x+â†©dâŠ‘ds
        '.'âˆ¾(kâ†‘ð•©)âˆ¾(1+k)â†“ð•©;
      ð•©
    } _underSelect_(sh {dâ‰¥2? (ð•©-1)-â†•ð•©; ð•©+â†©1 â‹„ ð•©+â†•ð•¨-ð•©}âŒ¾((Â¬2|d)âŠ¸âŠ‘) yâ€¿x) ð•©
  }Â´ âŒ½b
  â€¢Show 'O' Score c
}

# part 2
{
  Re â† {sâ€¿dð•Šð•©: dÂ¨âŒ¾((s=â¥Šð•©)/â¥Š) ð•©}
  c â† âˆ¾ËË˜ ("O[" Re a) â‰âŽ‰0 "O]" Re "@." Re a
  
  hâ€¿w â† â‰¢c
  
  yâ€¿x â† â‹ˆâ¼MDSlash c='@'
  {
    d â† âŠ‘">v<^"âŠð•©
    {
      âŠ‘dâˆŠ0â€¿2?
        c {
          (kâ†âŠ‘ð•©âŠ'.') < âŠ‘ð•©âŠ'#'?
            x+â†©dâŠ‘1â€¿0â€¿Â¯1â€¿0
            '.'âˆ¾(kâ†‘ð•©)âˆ¾(1+k)â†“ð•©;
          ð•©
        } _underSelect_âŸ¨y, {d=2? x-â†•x+1; x+â†•w-x}âŸ©â†©
      ;
        cy â† y
        dy â† dâŠ‘0â€¿1â€¿0â€¿Â¯1
        ai â† âŸ¨â‹ˆcy, â‹ˆxâŸ©
        {
          ð•Š xs:
          cy+â†©dy
          (cyâ‰¥0) âˆ§ cy<h?
          cv â† cyâ€¿xs Select c
          xsâ€¿cv (cvâ‰ '.')âŠ¸/Â¨â†©
          xsâˆ¾â†© (1+(cv='[')/xs) âˆ¾ Â¯1+(cv=']')/xs
          xsâ·â†©
          aiâˆ¾Â¨â†© âŸ¨cyÂ¨ xs, xsâŸ©
          xs
          ; â†•0
        }â€¢_while_(Ã—â‰ ) â‹ˆx
        av â† ai Select c
        { ð•Š:
          c '.'Â¨_underSelect_ aiâ†©
          c av _underSelect_(dyâ€¿0+ai)â†©
          y+â†© dy
        }âŸâŠ¢ âˆ§Â´'#'â‰ av
    }
    1
  }Â¨ b
  â€¢Show '[' Score c
}