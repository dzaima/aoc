#!/usr/bin/env bqn
MakeRand â† â€¢MakeRand
âŸ¨MDSlashâŸ© â† â€¢Import "../../utils/utils.bqn"

Join â† {(â‰ ğ•¨)â†“ âˆ¾ ğ•¨âŠ¸âˆ¾Â¨ ğ•©}
Repr â† '-'âŒ¾âŠ‘âŸ('Â¯'=âŠ‘) â€¢Repr

days â† â€¢HashMapËœâŸ¨âŸ©

_gen â† {ğ•© days.Set ğ•—}

_fxRand â† {p â† 10â‹†ğ•©-1 â‹„ p + ğ•¨ ğ•—.Range 9Ã—p} # ğ•©-digit numbers, no leading zeroes

{ ğ•Šr:
  n â† ScaleF 1000
  n2 â† nÃ—2
  {(âŠ£âˆ¾"   "âˆ¾âŠ¢)Â´ReprÂ¨ğ•©}Â¨ <Ë˜ nâ€¿2â¥Š (n2 r.Range n2) âŠ n2 r _fxRand ScaleD 5
} _gen 1

{ ğ•Šr:
  n â† ScaleF 1000
  vs â† (n r.Range 2) -âˆ˜âŠ¢âŸâŠ£Â¨ (5+ n r.Range 4) {
    l â† +` ğ•¨ r.Range 4
    o â† r.Range 3âŒŠâ‰ l
    l (Â¯10+20 r.RangeËœâ‰ )âŠ¸+âŒ¾((o r.Deal â‰ l)âŠ¸âŠ)â†©
    l
  }Â¨ n
  vs {{ğ•© + r.Range 99-âŒˆÂ´ğ•©} ğ•©-âŒŠÂ´ğ•©}Â¨â†©
  {' 'Join ReprÂ¨ ğ•©}Â¨ vs
} _gen 2

{ ğ•Šr:
  n â† ScaleF 17800
  l â† (n r.Range â‰ )âŠ¸âŠ "![]%^&*()_+muldon't()"
  Sprinkle â† {l ğ•©âŒ¾((â‰ ğ•©)â†‘(r.Range (â‰ l)-â‰ ğ•©)â†“âŠ¢)â†© â‹„ 1}Â¨
  Sprinkle {ğ•Š: aâ€¿bâ†2 r.Range 1000 â‹„ âˆ¾âŸ¨"mul(", Repr a, ",", Repr b, ")"âŸ©}Â¨ â†•âŒŠnÃ·15
  Sprinkle (âŒŠnÃ·600)â¥Š<"do()"
  Sprinkle (âŒŠnÃ·600)â¥Š<"don't()"
  l (@+10)Â¨âŒ¾(((âŒŠ0.5+ nÃ·3500) r.Deal â‰ l)âŠ¸âŠ)â†©
  l
} _gen 3

{ ğ•Šr:
  n â† ScaleF 140
  pts â† âŒ½âˆ˜â‰âŸ(â†•4) â‰"XMAS"
  ptsâˆ¾â†© {âŒ½Ë˜Â¨âŠ¸âˆ¾ âŒ½âŠ¸â‹ˆ ğ•©} 4â€¿4â¥Šâˆ¾âˆ¾âŸœ"...."Â¨ "XMAS"
  ptsâˆ¾â†© âŒ½âˆ˜â‰âŸ(â†•4) ["M.S",".A.","M.S"]
  m â† "XMAS" âŠËœ nâ€¿n r.Range 4
  pti â† {MDSlash ğ•©â‰ '.'}Â¨ pts
  ptc â† pti âŠ‘Â¨ pts
  ptr â† n- âŒˆÂ´Â¨ pti
  {
    m (ğ•©âŠ‘ptc)âŒ¾(((r.RangeÂ¨ ğ•©âŠ‘ptr)âŠ¸+Â¨ ğ•©âŠ‘pti)âŠ¸âŠ‘)â†©
    1
  }Â¨ (âŒŠÃ—Ëœn) r.Range â‰ pts
  m
} _gen 4

{ ğ•Šr:
  nodes â† âŒˆâŒ¾(Ã·âŸœ4) 24âŒˆ ScaleF 100
  tests â† ScaleD âŒŠnodesÃ—1.85
  
  q â† nodesÃ·4
  conn â† nodesâ€¿nodesâ¥Š0
  
  qs â† âŸ¨
    âŸ¨nodes-q-2, nodes-q-1âŸ©âŠ¸+Â¨ â†•q-2
    âŸ¨nodes-q+1, nodes-qâŸ©âŠ¸+Â¨ - â†•q-1
    âŒ½âŸ¨nodes-q, nodes-q-1âŸ©âŠ¸+Â¨ -âŠ¸â‹ˆÂ¨ â†•q-1
    âŒ½âŸ¨nodes-q-1, nodes-q+1âŸ©âŠ¸+Â¨ â‹ˆâŸœ-Â¨ â†•q-1
  âŸ©
  {
    yâ€¿x â† <Ë˜â‰>ğ•©
    conn 1Â¨âŒ¾((âˆ¾ y â‹ˆÂ¨Â¨ 1â†“â†‘x)âŠ¸âŠ‘)â†©
    1
  }Â¨ qs
  
  t â† { ğ•Š:
    qc â† (2+r.Range 2) âŠ‘ qs # I have no clue what happens with the other two quadrants
    k â† 1+2Ã— 2+ r.Range Â¯2+âŒŠqÃ·2
    is â† k r.Subset â‰ qc
    r.Dealâˆ˜â‰ âŠ¸âŠâŸ(r.Range 2) âŠ‘Â¨isâŠqc
  }Â¨ â†•tests
  
  d â† MDSlash conn
  
  nlâ†âŒŠnodesÃ·10
  shuf â† (â†•nl) âˆ¾ nl+r.Deal nodes-nl
  dâ€¿t âŠâŸœshufÂ¨Â¨â†©
  dâ€¿t r.Dealâˆ˜â‰ âŠ¸âŠÂ¨â†©
  
  ({'|'Join ReprÂ¨ğ•©}Â¨ d) âˆ¾âŸ¨âŸ¨âŸ©âŸ©âˆ¾ (','Join ReprÂ¨)Â¨ t
} _gen 5

{ ğ•Šr:
  ds â† (âŒ½-âŒ¾âŠ‘)âŸ(â†•4) Â¯1â€¿0
  
  w â† ScaleF 130
  cn â† Ã—Ëœw
  wa â† âŒˆ 0.05 Ã— cn # target wall amount
  p â† 1+2 r.Range w-2
  m â† wâ€¿wâ¥Š0 # 0:air/any/todo 1:wall 2:start 4:reqair
  m 2âŒ¾(pâŠ¸âŠ‘)â†©
  tgtSteps â† âŒˆ1.2Ã—w
  remaining â† tgtSteps
  tryLeft â† remainingÃ—20
  dir â† 0
  { ğ•Š:
    d â† dirâŠ‘ds
    l â† 2+r.Range w
    pe â† p + dÃ—l
    pw â† pe+d
    âˆ§Â´pwâ‰¥0? âˆ§Â´pw<w?
    0=peâŠ‘m?
    1â‰¥pwâŠ‘m?
    path â† (p + dÃ—âŠ¢)Â¨ â†•l+1
    âˆ§Â´1â‰ pathâŠ‘m?
    {0:1;
      path2 â† (âˆ§Â´â‰¥âŸœ0âˆ§<âŸœw)Â¨âŠ¸/ (pe + ((4|dir+1)âŠ‘ds)Ã—âŠ¢)Â¨ â†•w
      ok â† âˆ§Â´ (path2âŠ‘m)âˆŠ 0â€¿2â€¿4
      {ğ•Š: 1âŠ£m 4Â¨âŒ¾(path2âŠ¸âŠ‘)â†©} âŸâŠ¢ ok
      ok
    } remaining=1?
    m (4Ã—0=âŠ¢)âŠ¸+âŒ¾(pathâŠ¸âŠ‘)â†©
    m 1âŒ¾(pwâŠ¸âŠ‘) â†©
    p â†© pe
    dir â†© 4|dir+1
    remaining-â†©1
  ;
    0
  }â€¢_while_{ğ•Š: (0â‰¤tryLeft-â†©1) âˆ§ remainingâ‰ 0} @
  
  # â€¢Show tgtStepsâ€¿remainingâ€¿tryLeft
  remaining = 0?
  # m 3âŒ¾(pâŠ¸âŠ‘)â†©
  # â€¢Show mâŠ"Â·#^â•â€¢"
  m â†© {(â‰ ğ•©)â†‘/â¼ ((âŒŠ0.5Ã—â‰ ğ•©) âŒŠ 0âŒˆ wa - +Â´1=â¥Šm)r.Deal â‰ ğ•©}âŒ¾((0=m)/â—‹â¥ŠâŠ¢) m
  # â€¢Show mdâŠ"âˆ§>âˆ¨<Â·"
  ".#^"âŠËœ4|m
  ; retry
} _gen 6

{ ğ•Šr:
  n â† ScaleF 850
  distr â† +`(âŠ¢Ã·+Â´) 0â€¿0â€¿5â€¿5â€¿50â€¿25â€¿25â€¿20â€¿20â€¿20â€¿10â€¿10
  
  sum â† 0
  _gen â† {
    _try_ â† { ğ”½_ğ•£_ğ•˜ @:
      ops â† (ğ•˜ r.Range â‰ ğ•—) âŠ ğ•—
      args â† 1+ğ•˜ r.Range 99
      start â† 1+r.Range 999
      exp â† start {opâ€¿argğ•Šğ•©: ğ•© Op arg}Â´ âŒ½opsâ‹ˆÂ¨args
      exp<1e14?
      sum+â†© exp
      expâˆ¾startâˆ¾args
      ;@
    }
    ğ•— _try_ ğ•© â€¢_while_ (@âŠ¸â‰¡) @
  }
  
  ts â† {ğ•Š: 0âŒˆÂ¯1+r.Range 4}â—¶âŸ¨
    {(1+r.Range 2â‹†30+r.Range 20) âˆ¾ 1+ r.RangeÂ¨ Â¯1+ (1+ğ•©)â¥Š10â‹†1+r.Range 3}
    +â€¿Ã— _gen
    +â€¿Ã—â€¿{(ğ•¨ Ã— 10â‹†â‰ â€¢Reprğ•©) + ğ•©} _gen
  âŸ©Â¨ distr â‹ n r.Range 0
  
  sum<1e15?
  {âˆ¾âŸ¨ReprâŠ‘ğ•©, ": ", ' 'Join ReprÂ¨ 1â†“ğ•©âŸ©}Â¨ ts
  ; retry
} _gen 7

{ ğ•Šr:
  n â† ScaleF 50
  res â† nâ€¿nâ¥Š'.'
  chars â† (((âŒˆnÃ—1.04)âŒŠâ‰ ) r.Deal â‰ )âŠ¸âŠ âˆ¾"0Aa"+âŸœâ†•Â¨10â€¿26â€¿26
  { ğ•Š char:
    { ğ•Š:
      is â† 4 r.Deal nÃ—n
      âˆ§Â´'.'= isâŠâ¥Šres?
        1=âŒˆÂ´ â¥Š â€¢math.GCDÂ´ |-âŒœËœÂ¨ n(|â‹ˆâŒŠâˆ˜Ã·Ëœ)is?
          res charÂ¨âŒ¾(isâŠâ¥Š)â†©
          0
      ; 1
    }â€¢_while_âŠ¢ 1
  }Â¨ chars
  '.'â‰¡âŠ‘res?
  res
  ; retry
} _gen 8

{ ğ•Šr:
  n â† ScaleF 10000
  lâ†Â¯1â†“â¥Š(1+n r.Range 9) â‰Ë˜ n r.Range 10
  
  fs â† l / (â‰ l)â†‘ â¥Š (â†•n+1)â‰Ë˜Â¯1
  gs â† 2â†‘((+`âŒ¾âŒ½âˆ˜Â¬ > +`) fs=Â¯1) âŠ” fs
  âˆ§Â´Ã—â‰ Â¨gs?
  âˆ§Â´Â¯1â‰  {(âŠ‘ğ•¨)â‹ˆÂ¯1âŠ‘ğ•©}Â´gs? # no clue if this is a property the official inputs guarantee, but it was true on my input, and my solution breaks without it
  
  â‹ˆ'0'+l
  ; retry
} _gen 9

{ ğ•Šr:
  ds â† âŒ½Â¨âŠ¸âˆ¾ 0âŠ¸â‹ˆÂ¨ 1â€¿Â¯1
  n â† ScaleF 47
  mâ†nâ€¿n r.Range 10
  { ğ•Š:
    ps â† (<2 r.Range n) +`(10 r.Range 4)âŠds
    âˆ§Â´(âˆ§Â´â‰¥âŸœ0âˆ§<âŸœn)Â¨ ps? psâ‰¡â·ps?
      m (â†•10)âŒ¾(psâŠ¸âŠ‘)â†©
      1
    ;0
  }Â¨ â†•nÃ—nÃ—100
  '0'+<Ë˜m
} _gen 10

{ ğ•Šr:
  n â† ScaleF 8
  vs â† 0 âˆ¾ r _fxRandÂ¨ 7âŒŠ1+â†•n-1
  ' 'Join ReprÂ¨ vs
} _gen 11

# { ğ•Šr:
# } _gen

ScaleD â† !
ScaleF â† !
retry â† {â‡}
{
  args â† â€¢args
  Arg â† {ğ•Š: (argsâ†“Ëœâ†©1) âŠ¢ (1âŒŠâ‰ )âŠ¸â†‘args}
  path â† â‹ˆâ¼ Arg@
  day â† â€¢ParseFloat (âˆ§`('0'âŠ¸â‰¤âˆ§â‰¤âŸœ'9'))âŠ¸/ â€¢file.Name path
  seed â† â‰ â—¶âŸ¨1, ("u"âŠ¸â‰¡â—¶âŸ¨â€¢ParseFloat, {ğ•Š: sâ†â€¢rand.Range 1e9 â‹„ â€¢Out "Seed: "âˆ¾â€¢Repr s â‹„ s}âŸ©)âŠ‘âŸ© Arg@
  ScaleD â†© ArgâŠ¸{âŸ¨âŸ©ğ•Šğ•©: ğ•©; âŸ¨aâŸ©ğ•Šğ•©: â€¢ParseFloat a}
  ScaleF â†© ArgâŠ¸{âŸ¨âŸ©ğ•Šğ•©: ğ•©; âŸ¨aâŸ©ğ•Šğ•©: mâ†'x'=Â¯1âŠ‘a â‹„ ğ•©âŠ¸Ã—âŸm â€¢ParseFloat m-âŠ¸â†“a}

  f â† days.Get day
  rng â† MakeRand seed
  rn â† 0
  args0 â† args
  res â† {ğ•Š: argsâ†©args0 â‹„ rn+â†©1 â‹„ F rng}â€¢_while_ (retryâŠ¸â‰¡) retry
  {â€¢Out âˆ¾âŸ¨path, ": ", â€¢Repr ğ•©, " retries"âŸ©}âŸ(1âŠ¸â‰ ) rn
  path â€¢FLines â‹ˆâŸ(2=â€¢Typeâˆ˜âŠ‘) <Ë˜âŸ(2==) res
}