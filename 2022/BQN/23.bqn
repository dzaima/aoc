#!/usr/bin/env cbqn
âŸ¨RB, B10, Num, SInt, Ints, SInts, Split, SplitF, ReIndex, MDSlash, Unjoin, Count, GCD, LCM, _fx_, _fi_, TâŸ© â† â€¢Import "utils.bqn"
l â† '#'=>â€¢FLines â‰ â—¶"23.in"â€¿âŠ‘ â€¢args

Step â† {
  # ğ•© â†© Â¯1â€¿Â¯1âŒ½(2+â‰¢ğ•©)â†‘ğ•©
  ğ•© â†© â€¢internal.Squeeze 0Â¨âˆ˜âŠâŠ¸(âˆ¾âˆ¾âŠ£)0âˆ¾Ë˜ğ•©âˆ¾Ë˜0 # CBQN's slow at the above
  n â† (Â»Ë˜+Â«Ë˜+âŠ¢) (Â»+Â«+âŠ¢) ğ•©
  s â† ğ•©âˆ§1=n # stay where you are
  
  ah â† Â¬(Â»Ë˜âˆ¨Â«Ë˜âˆ¨âŠ¢) ğ•©
  av â† Â¬(Â» âˆ¨Â« âˆ¨âŠ¢) ğ•©
  an â† Â»ah â‹„ ae â† Â«Ë˜av
  as â† Â«ah â‹„ aw â† Â»Ë˜av
  
  o â† 4-+Â´âˆ¨`ğ•¨âŒ½anâ€¿asâ€¿awâ€¿ae
  sâˆ¨â†© o=4
  d â† (5Ã—sâˆ¨Â¬ğ•©)+4|ğ•¨+o # the direction each elf wants to move (â‰¥4 if doesn't)
  
  c â† ((Â»1=d)âˆ§Â«0=d) âˆ¨ (Â«Ë˜2=d)âˆ§Â»Ë˜3=d # conflict
  co â† ((1=d)âˆ§Â«c) âˆ¨ ((0=d)âˆ§Â»c) âˆ¨ ((2=d)âˆ§Â»Ë˜c) âˆ¨ ((3=d)âˆ§Â«Ë˜c) # conflict origin
  m â† ğ•© âˆ§ (Â¬s) âˆ§ Â¬co # all moving elves
  (ğ•©âˆ§Â¬m) âˆ¨ (Â«mâˆ§d=0) âˆ¨ (Â»mâˆ§d=1) âˆ¨ (Â«Ë˜mâˆ§d=2) âˆ¨ (Â»Ë˜mâˆ§d=3) # move elves
}

Trim â† {{ğ•©/Ëœ(âˆ¨`âˆ§âˆ¨`âŒ¾âŒ½)âˆ¨ËË˜ğ•©}âˆ˜â‰âŸ2 ğ•©}
Step2 â† {nâ€¿b: âŸ¨n+1, n Step bâŸ©}

# â€¢Show {1<â‰¡ğ•©? ğ•ŠÂ¨ğ•©; âˆ§Â´â¥Š(ğ•©=0)âˆ¨ğ•©=1? âŠâŸœ".#" ğ•©; '0'+ğ•©} {ğ•©{(-âŒŠ0.5Ã—ğ•©-â‰¢ğ•¨)âŒ½ğ•©â†‘ğ•¨}Â¨<âŒˆÂ´â‰¢Â¨ğ•©}âŠâŠ¢ l<âŠ¸âˆ¾ (<l) StepËœ` â†•5

â€¢Show +Â´â¥ŠÂ¬ Trim 1âŠ‘ Step2âŸ10 0â€¿l
â€¢Show 1+âŠ‘ TrimâŒ¾(1âŠ¸âŠ‘)âˆ˜Step2 _fx_(â‰¢â—‹(1âŠ¸âŠ‘)) 0â€¿l