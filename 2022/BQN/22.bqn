#!/usr/bin/env bqn
âŸ¨SplitF, Ints, MDSlashâŸ© â† â€¢Import "../../utils/utils.bqn"
b0â€¿m â† âŸ¨âŸ©SplitF â€¢FLines â‰ â—¶"22.in"â€¿âŠ‘ â€¢args
b0 {>ð•©â†‘ËœÂ¨âŒˆÂ´â‰ Â¨ð•©}â†©
b â† Â¯1â€¿Â¯1âŒ½(2+â‰¢b0)â†‘b0
# b2 â† ' 'Â¨b

l â† Ints âŠ‘m
dc â† 'R'âˆ¾âˆŠâŸœ"RL"âŠ¸/ âŠ‘m
da â† 4|Â¯1+`(dc='R')-dc='L' # right/down/left/up
dx â† (da=0)-da=2
dy â† (da=1)-da=3

p0 â† 1â‹ˆâŠ‘/'.'=1âŠb
Password â† {+Â´1000â€¿4â€¿1Ã—ð•©}

â€¢Show Password {
  p â† p0
  l { lð•Šdelta:
    { ð•Š:
      # pvâ†âŠ‘âŸœ">âˆ¨<âˆ§"âŠ‘deltaâŠËœ[0â€¿1,1â€¿0,0â€¿Â¯1,Â¯1â€¿0] â‹„ b2 pvâŒ¾((+Â´pÃ—1Â«â‰¢b2)âŠ‘â¥Š)â†©
      p2 â† delta+p
      v â† p2âŠ‘b
      { ð•Š:
        p2 â†© -âŸœdeltaâ€¢_while_{ð•Š: ' 'â‰¢(ð•©-delta)âŠ‘b} p
        v â†© p2âŠ‘b
      }âŸâŠ¢ vâ‰¡' '
      {ð•Š: pâ†©p2}âŸâŠ¢ vâ‰¢'#'
    }Â¨ â†•l
    ð•©
  }Â¨ <Ë˜â‰[dy, dx]
  p âˆ¾ Â¯1âŠ‘da
}

w â† {50â‰¤â‰ b0? 50; 4}

ds â† âŸ¨0â€¿1, 1â€¿0, 0â€¿Â¯1, Â¯1â€¿0âŸ©

bs â† (w/Â¨â†•Â¨ wÃ·Ëœâ‰¢b0)âŠ”b0
bh â† ' 'â‰ âŠ‘Â¨bs
be â† @Â¨ bh
Fold â† { vsâ€¿p:
  be vsâŒ¾(pâŠ¸âŠ‘)â†©
  p2 â† p<âŠ¸+ ds # right down left up
  h2 â† p2 {ð•©â‰¡0? 0; (@â‰¡ð•¨âŠ‘be)âˆ§ð•¨âŠ‘bh}Â¨ âˆ§Â´Â¨ (p2â‰¥0) âˆ§ p2<<â‰¢bs
  (h2/â†•4) {
    ds â† ð•¨âŠ‘âŸ¨1â€¿0,2â€¿0,0â€¿1,0â€¿2âŸ© # move all vertices by the delta between the selected of these
    vs2 â† vs+<-Â´dsâŠvs
    vs2 {Â¯1âŒˆ1âŒŠð•©Ã—<Â¯1â‹†(âˆ§Â´1=|ð•©)âˆ§=Â´ð•©}âŒ¾(({âŠ‘3âˆŠ|ð•©}Â¨vs2)âŠ¸/)â†© # actual fold crappy magic
    Fold âŸ¨vs2, p+ð•©âŸ©
  }Â¨ h2/ds
}
Fold âŸ¨Â¯1+2Ã—âŸ¨0â€¿0â€¿0, 1â€¿0â€¿0, 0â€¿1â€¿0, 1â€¿1â€¿0âŸ©, âŠ‘MDSlash bhâŸ©

# â€¢Show >Â¨ be
# â€¢Show {@:@;âˆ¾Ë˜Â´<Ë˜2â€¿1â€¿0â‰('0'+â†•4)âŒ¾((ð•©âŠËœâŒ½â¥ŠÂ¯1â‹†â†•2â€¿2â€¿2)âŠâ¥Š) 2â€¿2â€¿2â¥Š' '}Â¨ be
Translate â† { d0 ð•Š p0:
  e0 â† d0âŠ‘âŸ¨1â€¿3, 3â€¿2, 2â€¿0, 0â€¿1âŸ©
  e0v â† e0 âŠ p0âŠ‘be
  p1 â† â‹ˆâ¼ (MDSlash{@:0; âˆ§Â´e0vâˆŠð•©}Â¨ be) (Â¬âˆ˜âˆŠ/âŠ£) â‹ˆp0
  e1 â† e0vâŠËœp1âŠ‘be
  d1 â† âŠ‘âŸ¨0â€¿2,1â€¿0,3â€¿1,2â€¿3âŸ©âŠ< e1
  # â€¢Show âŸ¨d1, p1, '0'+e1âŸ©
  d1â€¿p1
}
# â€¢Show â·â¥Š2âŠ‘Â¨(â†•4) TranslateâŒœ MDSlash bh

wp â† w-1

â€¢Show Password {
  p â† p0
  d â† 3
  l { lð•Šdd:
    d â†© 4|d+dd
    { ð•Š:
      # â€¢Show pâˆ¾d
      # pvâ†âŠ‘âŸœ">âˆ¨<âˆ§"âŠ‘d â‹„ b2 pvâŒ¾((+Â´pÃ—1Â«â‰¢b2)âŠ‘â¥Š)â†©
      
      p1 â† (dâŠ‘ds)+p
      d1 â† d
      { ð•Š:
        pb0 â† âŒŠwÃ·Ëœp-1
        pwyâ€¿pwx â† w|p-1
        off â† d âŠ‘ âŸ¨pwy,wp-pwx,wp-pwy,pwxâŸ©
        # â€¢Show "rot from "âˆ¾â€¢Repr âŸ¨d, p, pb0, offâŸ©
        
        d2â€¿pb2 â† d Translate pb0
        off â†© wp-off
        
        d1 â†© d2
        p1 â†© 1 + (wÃ—pb2) + d2âŠ‘âŸ¨âŸ¨wp-off,0âŸ©, âŸ¨0,offâŸ©, âŸ¨off,wpâŸ©, âŸ¨wp,wp-offâŸ©âŸ©
        # â€¢Show "rot to "âˆ¾â€¢Repr âŸ¨d2, p1, pb2, offâŸ©
      }âŸâŠ¢ ' 'â‰¡p1âŠ‘b
      {ð•Š: pâ†©p1 â‹„ dâ†©d1}âŸâŠ¢ '#'â‰¢p1âŠ‘b
    }Â¨ â†•l
    ð•©
  }Â¨ Â¯1â‹†dc='L'
  p âˆ¾ d
}
# â€¢Show b{ð•©â‰¡' '?ð•¨;ð•©}Â¨b2