#!/usr/bin/env bqn
âŸ¨Split,MDSlashâŸ© â† â€¢Import "../../utils/utils.bqn"
l â† â€¢FChars â‰ â—¶"17.in"â€¿âŠ‘ â€¢args
r â† '>'=l

Set1 â† {ğ•¨ 1âŒ¾((+Â´ğ•©Ã—1Â«â‰¢ğ•¨)âŠ‘â¥Š)â†©}

pcb â† {âŒ½>'#'=(@+10)Splitğ•©}Â¨ '-'Split"
####
-
.#.
###
.#.
-
..#
..#
###
-
#
#
#
#
-
##
##"

pci â† MDSlashÂ¨ pcb
pcw â† â‰ âˆ˜âŠÂ¨ pcb
pch â† â‰ Â¨ pcb

Game â† { ğ•Š:
  board â† 100â€¿7â¥Š0
  h â‡ 0

  pi â† 0
  p â† 3â€¿2
  si â† 0

  done â‡ 0

  Step â‡ { ğ•Š:
    cr â† siâŠ‘r
    cpci â† piâŠ‘pci
    p+â†© {
      cr?  0â€¿1Ã—{(7-piâŠ‘pcw)>1âŠ‘p? Â¬âˆ¨Â´((p+ 0â€¿1)<âŠ¸+cpci)âŠ‘board; 0}
      ;   0â€¿Â¯1Ã—{ 0        <1âŠ‘p? Â¬âˆ¨Â´((p+0â€¿Â¯1)<âŠ¸+cpci)âŠ‘board; 0}
    }
    fall â† {0<âŠ‘p? Â¬âˆ¨Â´((p+Â¯1â€¿0)<âŠ¸+cpci)âŠ‘board; 0}
    {
      fall?
        p+â†© Â¯1â€¿0
      ;
        {board Set1â†© ğ•© â‹„ 1}Â¨ p<âŠ¸+ piâŠ‘pci
        hâŒˆâ†© (âŠ‘p)+piâŠ‘pch
        
        pi â†© (â‰ pci)|pi+1
        
        p â†© âŸ¨h+3, 2âŸ©
        done+â†© 1
        {ğ•Š:
          boardâˆ¾â†© 0Â¨board
        }âŸâŠ¢ h>Â¯10+â‰ board
    }
    si â†© (â‰ r)|1+si
  }
  Status â‡ {ğ•Š: siâ€¿pi}
}

p1 â† Game@
p1.Step â€¢_while_ {ğ•Š: p1.done<2022} 1
â€¢Show p1.h


iter â† 1000000000000
p2 â† Game@
warm â† 2000
p2.Step â€¢_while_ {ğ•Š:  p2.doneâ‰¤warm} 1 â‹„ h1â†p2.h â‹„ d1â†p2.done â‹„ s1 â† p2.Status@ â‹„ p2.Step@
p2.Step â€¢_while_ {ğ•Š: s1â‰¢p2.Status@} 1 â‹„ h2â†p2.h â‹„ d2â†p2.done

skip â† âŒŠ(iter-p2.done) Ã· (d2-d1)
skipIter â† skip Ã— d2-d1
skipHeight â† skip Ã— h2-h1

p2.Step â€¢_while_ {ğ•Š: p2.done < iter-skipIter} 1
â€¢Show p2.h + skipHeight
