#!/usr/bin/env cbqn
âŸ¨SplitâŸ© â† â€¢Import"utils.bqn"
rsâ€¿re â† <Ë˜â‰>'-'SplitÂ¨â€¢FLines â‰ â—¶"12.in"â€¿âŠ‘ â€¢args

u â† â·rsâˆ¾re # unique caves
big â† ('A'âŠ¸â‰¤âˆ§â‰¤âŸœ'Z') âŠ‘Â¨u # whether each of them are big
spâ€¿ep â† uâŠ"start"â€¿"end" # start and end cave numbers

sâ€¿e â† âˆ¾Â¨âŸœâŒ½rsâ€¿re âŠËœÂ¨ <u # connected cave pairs
c â† {(s=ğ•©)/e}Â¨ â†•â‰ u # list of connected caves for each cave

mid â† /Â¬(â†•â‰ u)âˆŠspâ€¿ep # indexes on non-endpoint caves (ones that we may want to add to lists)

Step â† { râ€¿aâ€¿lâ€¿v: # result, second visit available, last position, masks of visited caves
  asâ€¿lsâ€¿vs â† <Ë˜â‰>{ğ•Š: # iterate through all caves
    cc â† ğ•©âŠ‘c           # get ones adjacent to the current one
    lm â† lâˆŠcc          # mask of paths adjacent to current ones
    f â† (ğ•©âŠ‘big) âˆ¨ Â¬ğ•©âŠ‘v # always fine to add - either big, or not already present
    o â† lm âˆ§ f âˆ¨ a     # okay to add
    âŸ¨o/aâˆ§f â‹„ (+Â´o)â¥Šğ•© â‹„ 1Â¨âŒ¾(ğ•©âŠ¸âŠ‘) oâŠ¸/Â¨ vâŸ©
  }Â¨ mid
  done â† +Â´lâˆŠepâŠ‘c # count number of rows that are adjacent to the end
  âŸ¨r+done â‹„ âˆ¾as â‹„ âˆ¾ls â‹„ âˆ¾Â¨ <Ë˜â‰>vsâŸ©
}

â€¢ShowÂ¨ {âŠ‘ Stepâ€¢_while_{0â‰ â‰ 1âŠ‘ğ•©} âŸ¨0 â‹„ âŸ¨ğ•©âŸ© â‹„ âŸ¨spâŸ© â‹„ â‹ˆÂ¨ sp=â†•â‰ uâŸ©}Â¨ 0â€¿1