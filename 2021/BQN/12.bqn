#!/usr/bin/env cbqn
âŸ¨SplitâŸ© â† â€¢Import"utils.bqn"
rsâ€¿re â† <Ë˜â‰>'-'SplitÂ¨â€¢FLines â‰ â—¶"12.in"â€¿âŠ‘ â€¢args

u â† â·rsâˆ¾re # unique caves
big â† ('A'âŠ¸â‰¤âˆ§â‰¤âŸœ'Z') âŠ‘Â¨u # whether each of them are big
spâ€¿ep â† uâŠ"start"â€¿"end" # start and end cave numbers

sâ€¿e â† âˆ¾Â¨âŸœâŒ½rsâ€¿re âŠËœÂ¨ <u # connected cave pairs
c â† {(s=ğ•©)/e}Â¨ â†•â‰ u # list of connected caves for each cave

Step â† { râ€¿l:
  l â†© âˆ¾{
    aâ€¿v: # a - is second visit available
      l â† Â¯1âŠ‘v            # last
      lâ‰ ep?               # if not at end:
      n â† lâŠ‘c             # caves connected to this one
      f â† (nâŠbig) âˆ¨ Â¬nâˆŠv  # always fine to add - either big, not not already present
      nâ€¿f/ËœÂ¨â†© <f âˆ¨ aâˆ§nâ‰ sp # if can't use second visit, remove ones not 'always fine to add'
      (aâˆ§f) â‹ˆÂ¨ vâŠ¸âˆ¾Â¨ n;    # and return the pairs
    ğ•Š:
      r+â†©1 # else, at end, increase counter
      âŸ¨âŸ©   # and return an empty list for next step
  }Â¨ l
  râ€¿l
}

â€¢ShowÂ¨ {âŠ‘ Stepâ€¢_while_{0â‰ â‰ 1âŠ‘ğ•©} âŸ¨0â‹„âŸ¨âŸ¨ğ•©â‹„âŸ¨spâŸ©âŸ©âŸ©âŸ©}Â¨ 0â€¿1
