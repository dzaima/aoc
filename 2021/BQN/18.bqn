#!/usr/bin/env cbqn
l â† â€¢FLines â‰ â—¶"18.in"â€¿âŠ‘ â€¢args

P â† {
  m â† (â‰¥âŸœ'0'âˆ§â‰¤âŸœ'9')ğ•©
  d â† +`(ğ•©='[')-ğ•©=']'
  âŸ¨'0'-Ëœm/ğ•© â‹„ m/dâŸ©
}
l PÂ¨â†©

NHP â† {ğ•¨â€¿ğ•©} # non-horrible pair

Mag â† âŠ‘âˆ˜âŠ‘ {cğ•Švâ€¿d:
  cd â† d=c
  l â† â‰ `cd
  r â† Â»l
  nv â† ((3Ã—l/v)+2Ã—r/v)âŒ¾(lâŠ¸/) v
  nd â† (c-1)Â¨âŒ¾(lâŠ¸/) d
  (Â¬r)âŠ¸/Â¨ nvâ€¿nd
}Â´âŸœ(1+â†•4)

Expl â† {ğ•Švâ€¿d:
  ml â† d=5
  Ã—+Â´ml?
    ml>â†© Â»âˆ¨`ml
    mr â† Â»ml
    v+â†© Â«mlÃ—v
    v+â†© Â»mrÃ—v
    vÃ—â†© Â¬ml
    (Â¬mr)âŠ¸/Â¨ v NHP d-ml
  ;ğ•©
}

Spl â† {ğ•Švâ€¿d:
  m â† v>9
  Ã—+Â´m?
    m>â†© Â»âˆ¨`m
    i â† âŠ‘/m
    nv â† âˆ¾âŸ¨iâ†‘v â‹„ (âŒŠNHPâŒˆ)2Ã·ËœiâŠ‘v â‹„ (1+i)â†“vâŸ©
    nd â† (m+1)/d+m
    nvâ€¿nd
  ;ğ•©
}

Step â† {SplâŸ(ğ•©âŠ¸â‰¡) Expl ğ•©}
Simplify â† {âŠ‘{pâ€¿c:c NHP Step c}â€¢_while_(â‰¢Â´) ğ•© NHP Stepğ•©}

Add â† {Simplify 1âŠ¸+âŒ¾(1âŠ¸âŠ‘) ğ•¨âˆ¾Â¨ğ•©}

â€¢Show Mag AddËœÂ´âŒ½ l
â€¢Show âŒˆÂ´â¥Š Magâˆ˜AddâŒœËœ l