#!/usr/bin/env cbqn
âŸ¨RBâŸ© â† â€¢Import "utils.bqn"
l â† âŠ‘â€¢FLines â‰ â—¶"16.in"â€¿âŠ‘ â€¢args

St â† {ğ•Šs:
  i â‡ 0
  B â‡ {ğ•Š: i+â†©1 â‹„ (i-1)âŠ‘s}
  N â‡ {ğ•Š: RB BÂ¨â†•ğ•©}
}

s â† St âˆ¾(lâŠËœ('0'+â†•10)âˆ¾('A'+â†•6))âŠâ¥Šâ†•4â¥Š2

vsum â† 0
Packet â† {ğ•Šp:
  v â† p.N 3
  t â† p.N 3
  vsum+â†© v
  {
    t=4?
      numâ†0
      {ğ•Š: nâ†p.B@ â‹„ num â†© (numÃ—16) + p.N 4 â‹„ n}â€¢_while_âŠ¢1
      num
    ;
    lty â† p.B@
    rs â† {
      lty=0?
        end â† p.i + p.N 15
        ps â† âŸ¨âŸ©
        {ğ•Š:psâˆ¾â†©<Packet p}â€¢_while_{ğ•Š:p.i<end} @;
      lty=1?
        {ğ•Š:Packet p}Â¨ â†•p.N 11
    }
    tâ—¶+â€¿Ã—â€¿âŒŠâ€¿âŒˆâ€¿!â€¿>â€¿<â€¿=Â´ rs
  }
}

res â† Packet s
â€¢Show vsum
â€¢Show res