#!/usr/bin/env cbqn

# recursion based, with nested arrays everywhere
P â† â€¢BQN {'âŸ¨'Â¨âŒ¾(('['=ğ•©)âŠ¸/) ğ•©}âˆ˜{'âŸ©'Â¨âŒ¾((']'=ğ•©)âŠ¸/) ğ•©}
l â† PÂ¨ â€¢FLines â‰ â—¶"../18.in"â€¿âŠ‘ â€¢args

aiâ†âˆ â‹„ aaâ†0

i â† 0
ExplGet â† {
  4ğ•Šlâ€¿r: aaâ‰¡0?
    ai â†© i+0â€¿2
    aa â†© lâ€¿râ€¿0
    0;
  0=â€¢Typeğ•©?
    (ğ•¨+1) ğ•ŠÂ¨ ğ•©;
  dğ•Šğ•©:
    i+â†© 1
    ğ•©
}âŸœ{iâ†©0â‹„aaâ†©0â‹„ğ•©}
ExplSet â† {
  ğ•Šlâ€¿r:
    ğ•ŠÂ¨ lâ€¿r;
  ğ•Šğ•©:
    i+â†© 1
    ğ•© + (âŠ‘aiâŠi)âŠ‘aa
}âˆ˜{iâ†©0â‹„aiâ€¿aaâ‹„ğ•©}

spld â† 0
Spl â† {
  ğ•Šlâ€¿r: ğ•ŠÂ¨ lâ€¿r;
  spld? ğ•©;
  ğ•©>9? spldâ†©1 â‹„ (âŒŠâ‹ˆâŒˆ)ğ•©Ã·2;
  ğ•©
}âˆ˜{spldâ†©0â‹„ğ•©}

Expl â† {
  ExplSetâŸ(aaâ‰¢0) 0 ExplGet ğ•©
}

Step â† {SplâŸ(ğ•©âŠ¸â‰¡) Expl ğ•©}

Simplify â† {âŠ‘{pâ€¿c:câ‹ˆStep c}â€¢_while_(â‰¢Â´) ğ•©â‹ˆStepğ•©}


Add â† Simplify â‹ˆ


Mag â† {ğ•Šlâ€¿r: +Â´3â€¿2Ã—ğ•ŠÂ¨lâ€¿r; ğ•©}

â€¢Show Mag AddËœÂ´âŒ½ l
â€¢Show âŒˆÂ´ â¥ŠMagâˆ˜AddâŒœËœ l