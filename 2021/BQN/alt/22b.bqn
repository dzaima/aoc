#!/usr/bin/env -S cbqn -M 4200
# stores an array of whether each point is on, and sets them for each cube
# CBQN make command to make this faster:
# make t=day22 f='-DCHECK_VALID=0 -march=native -O3' singeli=1 c

âŸ¨RB, B10, Num, Ints, SInts, SplitâŸ© â† â€¢Import "../utils.bqn"
l â† {âŸ¨'n'=1âŠ‘ğ•© â‹„ <Ë˜â‰3â€¿2â¥ŠSIntsğ•©âŸ©}Â¨ â€¢FLines â‰ â—¶"../22.in"â€¿âŠ‘ â€¢args

Do â† { ğ•Šinp:
  on â† âŠ‘Â¨inp
  csâ€¿ce â† {<Ë˜â‰>ğ•©}Â¨ 0â€¿1+<Ë˜â‰>1âŠ‘Â¨inp
  u â† â·âˆ˜âˆ§Â¨ csâˆ¾Â¨ce

  mcs â† uâŠÂ¨cs
  mce â† uâŠÂ¨ce
  sh â† â‰ Â¨u
  b â† Â¯2+(Ã—Â´sh)â¥Š2 # don't bitarr
  on {
    sâ€¿e â† ğ•©âŠ‘Â¨Â¨mcsâ€¿mce
    idxs â† {âˆ¾ğ•¨+<ğ•©}Â´ (âŒ½Ã—`1Â»âŒ½sh)Ã— s +â†•Â¨ e-s
    b (Â¯2+(â‰ idxs)â¥Š2+ğ•¨)âŒ¾(idxsâŠ¸âŠ)â†©
    1
  }Â¨ â†•â‰ âŠ‘mcs
  
  zsz â† 2âŠ‘sh
  zi â† â†•zsz-1
  zw â† (1âŠ¸â†“-Â¯1âŠ¸â†“) 2âŠ‘u
  br â† shâ¥Šb
  +Â´{ğ•Šxy:
    (Ã—Â´ ((1+xy)âŠ‘Â¨2â†‘u) - (xyâŠ‘Â¨2â†‘u)) Ã— +Â´zwÃ— Â¯1â†“brâŠÂ´âŒ½xy
  }Â¨ â¥Šâ†•(2â†‘sh)-1
}


â€¢Show Do {âŸ¨vâ‹„sâ€¿eâŸ©: âˆ§Â´ (sâ‰¥Â¯50)âˆ§eâ‰¤50}Â¨âŠ¸/ l
â€¢Show Do l