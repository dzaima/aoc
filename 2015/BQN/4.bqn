#!/usr/bin/env bqn
âŸ¨InputâŸ© â† â€¢Import "../../utils/utils.bqn"
l â† â€¢FChars 2015â€¿4 Input â€¢args

cÂ¯32 â† 2â‹†32
U32 â† â€¢internal.Squeeze -âŸœ(cÂ¯32Ã—â‰¥âŸœ(cÂ¯32Ã·2))
Add32 â† 32â€¢bit._add
And32 â† 32â€¢bit._and
Or32  â† 32â€¢bit._or
Not32 â† 32â€¢bit._not
Xor32 â† 32â€¢bit._xor

# constants
cÂ¯k â† U32 âŒŠcÂ¯32Ã—|â€¢math.Sin 1+â†•64
cÂ¯s â† âˆ¾16âŠ¸â¥ŠÂ¨ âŸ¨7â€¿12â€¿17â€¿22, 5â€¿9â€¿14â€¿20, 4â€¿11â€¿16â€¿23, 6â€¿10â€¿15â€¿21âŸ©
cÂ¯abcd â† U32 1732584193â€¿4023233417â€¿2562383102â€¿271733878
cÂ¯rounds â† {
  fsâ€¿gs â† <Ë˜â‰>âŸ¨
    {ğ•Šaâ€¿bâ€¿câ€¿d: (b And32 â‹ˆc) Or32 (Not32 â‹ˆb) And32 d}â€¿{ğ•Ši: i}
    {ğ•Šaâ€¿bâ€¿câ€¿d: (d And32 â‹ˆb) Or32 (Not32 â‹ˆd) And32 c}â€¿{ğ•Ši: 16|1+5Ã—i}
    {ğ•Šaâ€¿bâ€¿câ€¿d:                   b Xor32 c Xor32 â‹ˆd}â€¿{ğ•Ši: 16|5+3Ã—i}
    {ğ•Šaâ€¿bâ€¿câ€¿d:              c Xor32 b Or32 Not32 â‹ˆd}â€¿{ğ•Ši: 16|  7Ã—i}
  âŸ©
  { ğ•Š i:
    r â† âŒŠğ•©Ã·16
    g â† {ğ• i} râŠ‘gs
    âŸ¨râŠ‘fs, g, iâŠ‘cÂ¯k, -iâŠ‘cÂ¯sâŸ©
  }Â¨ â†•64
}

MD5 â† {
  m â† 8â€¿1â€¢bit._cast ğ•©
  mâˆ¾â†© Â¯8â†‘1
  mâˆ¾â†© 0â¥ŠËœ512|448-â‰ m
  mâˆ¾â†© 64â†‘ 32â€¿1â€¢bit._cast â‹ˆ8Ã—â‰ ğ•© # only works for (â‰ ğ•©)<2â‹†28 but that's fine
  abcd0 â† cÂ¯abcd
  
  {
    m â† â¥ŠË˜ 1â€¿32â€¢bit._cast âˆ˜â€¿32â¥Šğ•©
    aâ€¿bâ€¿câ€¿d â† abcd0
    { Fâ€¿gâ€¿kâ€¿ns:
      f â†© F aâ€¿bâ€¿câ€¿d
      f â†© f Add32 a Add32 k Add32 gâŠm
      a â†© d
      d â†© c
      c â†© b
      b â†© âŠ‘b Add32 1â€¿32â€¢bit._cast ns âŒ½ 32â€¿1â€¢bit._cast f
    }Â¨ cÂ¯rounds
    abcd0 Add32â†© aâ€¿bâ€¿câ€¿d
    @
  }Ë˜ âˆ˜â€¿16â€¿32â¥Š m
  r â† â¥ŠâŒ½Ë˜âˆ˜â€¿2â¥Š +ËË˜(2â‹†â†•4) Ã—â‰1 âˆ˜â€¿4â¥Š32â€¿1â€¢bit._cast abcd0
  # â€¢Show 1â†“â¥Š' 'âˆ¾Ë˜âˆ˜â€¿8â¥ŠrâŠâˆ¾"0A"+âŸœâ†•Â¨10â€¿6
  r
}

Min â† {tgt ğ•Š start: 1âŠ¸+ â€¢_while_{tgt > +Â´âˆ§`0=MD5 lâˆ¾â€¢Repr ğ•©} start}

p1 â† 5 Min 1
â€¢Show p1
â€¢Show 6 Min p1