#!/usr/bin/env bqn
âŸ¨_fx_, TrâŸ© â† â€¢Import "../../utils/utils.bqn"
l â† >â€¢FLines â‰ â—¶"16.in"â€¿âŠ‘ â€¢args
# direction lists: up, right, down, left

rots â† âŸ¨âŠ¢, âŒ½â‰, âŒ½âŒ½Ë˜, â‰âŒ½âŸ©
n â† â‰ l
ymâ€¿xm â† Tr â†•â‰¢l
iota â† â†•n

info â† >(â†•4) { dir ğ•Š ğ•©:
  c â† âŠâŸœ"/\-|." ("/\-|"â€¿"\/|-"âŠ‘Ëœ2|dir) âŠ ğ•l # unrotate to going upwards, aka negative y, aka towards Â¯âˆâ€¿0
  e â† c âˆŠ "/\-"
  dist â† (âŠ¢-Â·âŒˆ`eÃ—âŠ¢)â†•â‰ e
  ib â† âˆ¨`e # in-bounds
  end â† â†•âˆ˜â‰ âŠ¸- dist
  tgt â† (iota +â‰1 endÃ—n) âŠ â¥Šc
  ğ•â¼ Tr âŸ¨dist, (xmâ‰ 0)âˆ§ibâˆ§tgtâˆŠ"-\", (xmâ‰ n-1)âˆ§ibâˆ§tgtâˆŠ"-/"âŸ©
}Â¨ rots


memo â† â€¢HashMapËœâŸ¨âŸ©
deltas â† âŸ¨Â¯1â€¿0, 0â€¿1, 1â€¿0, 0â€¿Â¯1âŸ©
Get â† {
  dirâ€¿y0â€¿x0:
    ğ•© memo.Set 0
    distâ€¿lâ€¿r â† ğ•©âŠ‘info
    y1â€¿x1 â† y0â€¿x0 + distÃ—dirâŠ‘deltas
    me â† {
      2|dir? x0sâ€¿x1sâ†âˆ§x0â€¿x1 â‹„ (iota=y0) âˆ§âŒœ  (iotaâ‰¥x0s) âˆ§ iotaâ‰¤x1s;
             y0sâ€¿y1sâ†âˆ§y0â€¿y1 â‹„ (iota=x0) âˆ§âŒœËœ (iotaâ‰¥y0s) âˆ§ iotaâ‰¤y1s
    }
    res â† me âˆ¨Â´ (4|dir+3â€¿1) {
      Â¬ğ•©? 0;
      Get ğ•¨ âˆ¾ y1â€¿x1 + ğ•¨âŠ‘deltas
    }Â¨ lâ€¿r
    ğ•© memo.Set res
    res
} {memo.Has ğ•©? memo.Get ğ•©; ğ”½ ğ•©}

Count â† {
  memo â†© â€¢HashMapËœâŸ¨âŸ©
  +Â´â¥ŠGet ğ•©
}

â€¢Show Count âŸ¨1,0,0âŸ©

â€¢Show âŒˆÂ´ âˆ¾âŸ¨
  {Count âŸ¨0, n-1, ğ•©âŸ©}Â¨ iota # up
  {Count âŸ¨1, ğ•©,   0âŸ©}Â¨ iota # right
  {Count âŸ¨2, 0,   ğ•©âŸ©}Â¨ iota # down
  {Count âŸ¨3, ğ•©, n-1âŸ©}Â¨ iota # right
âŸ©
