#!/usr/bin/env bqn
âŸ¨InputâŸ© â† â€¢Import "../../utils/utils.bqn"
l â† >â€¢FLines 2023â€¿21 Input â€¢args

nw â† lâ‰ '#' # not wall
ls â† l='S' # start

Step â† {nwâˆ§âˆ¨Â´âŸ¨Â»ğ•©,Â«ğ•©,Â»Ë˜ğ•©,Â«Ë˜ğ•©âŸ©}
â€¢Show +Â´â¥ŠStepâŸ64 ls

r0 â† 3     # how many repetitions of input to process
s0 â† â‰ l    # initial side length
x â† 1+2Ã—r0 # number of blocks to expand to

# expand input
nw â†© âˆ¾ xâ€¿x â¥Š <nw
ls â†© âˆ¾ lsâŒ¾((âŒŠxâ€¿xÃ·2)âŠ¸âŠ‘) xâ€¿xâ¥Š <0Â¨ls

stgt â† 26501365 # target number of steps
sdone â† (r0Ã—s0) + s0|stgt # steps to actually evaluate
sums â† +Â´âˆ˜â¥ŠÂ¨ {<â‰2 0â€¿2â€¿1â€¿3â‰xâ€¿s0â€¿xâ€¿s0â¥Šğ•©} StepâŸsdone ls # run that many steps, sum each block

rep â† (stgt-sdone)Ã·s0 # number of repetitions still left
rtot â† rep + r0 # total repetitions needed

â€¢Show +Â´{
  r â† +Â´â¥Š sums = ğ•©
  ğ•© Ã— { # multiply each distinct sum per block by the number of expected such blocks in the total, based on the pattern of how many were encountered in the sample
    r â‰¡ 1?      1;
    r â‰¡ r0-1?   rtot-1;
    r â‰¡ r0?     rtot;
    r â‰¡ Ã—Ëœr0-1? Ã—Ëœrtot-1;
    r â‰¡ Ã—Ëœr0?   Ã—Ëœrtot;
    ! "unknown count"
  }
}Â¨ 0âŠ¸â‰ âŠ¸/ â·â¥Šsums