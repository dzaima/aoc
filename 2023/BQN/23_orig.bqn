#!/usr/bin/env bqn
âŸ¨MDSlash, _fx_, InputâŸ© â† â€¢Import "../../utils/utils.bqn"
l â† >â€¢FLines 2023â€¿23 Input â€¢args
w â† l='#'
u â† lâˆŠ"^."
d â† lâˆŠ"v."
leâ† lâˆŠ"<."
r â† lâˆŠ">."


z â† 0Â¨l
Run â† { prevâ€¿curr:
  {âŸ¨1âŒ¾(ğ•©âŠ¸âŠ‘)prev, 1âŒ¾(ğ•©âŠ¸âŠ‘)zâŸ©}Â¨ MDSlash (Â¬wâˆ¨prev)âˆ§âˆ¨Â´âŸ¨Â»currâˆ§d,Â«currâˆ§u, Â«Ë˜currâˆ§le, Â»Ë˜currâˆ§râŸ©
}
c â† 0
{
  c+â†©1
  # â€¢Show â‰ ğ•©
  âˆ¾RunÂ¨ ğ•©
}â€¢_while_{Ã—â‰ ğ•©} â‹ˆ â‹ˆËœ('.'=âŠl)âŒ¾âŠ 0Â¨l
â€¢Show c-1

cj â† {ğ•©Ã—2<+Â´âŸ¨Â»ğ•©,Â«ğ•©,Â»Ë˜ğ•©,Â«Ë˜ğ•©âŸ©}Â¬w # conjunctions
cjâˆ¨â†© (Â¬w) âˆ§ â†•âŠ¸(=âŸœ0 âˆ¨ âŠ£=Â¯1+âŠ¢) â‰ w # add in start & end
cji â† MDSlash cj

sln â† (Â¬w) âˆ§ Â¬cj # straight line
cjd â† {
  cjc â† âˆÂ¨ cji
  iâ†0
  {
    n â† âˆ¨Â´âŸ¨Â»ğ•©,Â«ğ•©,Â»Ë˜ğ•©,Â«Ë˜ğ•©âŸ©
    cjcâŒŠâ†© i+Ã·cjiâŠ‘nâˆ§Â¬ğ•©
    i+â†© 1
    ğ•©âˆ¨slnâˆ§n
  }_fx_â‰¢ 1âŒ¾(ğ•©âŠ¸âŠ‘) z
  cjc
}Â¨ cji

cjc â† âˆâ‰ cjd # connected
cjo â† (0Â¨cji)Â¨ cji # ok
cjde â† âˆâŠ¸â‰ âŠ¸/Â¨ cjd
mx â† 0
ln â† Â¯1+â‰ cjd
{
  # â€¢Show â‰ ğ•©
  âˆ¾{vâ€¿d: â‹„ lâ†Â¯1âŠ‘v â‹„ mxâŒˆâ†©dÃ—l=ln â‹„ nâ†/lâŠ‘cjc â‹„ mâ†Â¬nâˆŠv â‹„ (m/lâŠ‘cjde) {âŸ¨vâˆ¾ğ•©,d+ğ•¨âŸ©}Â¨ m/n}Â¨ğ•©
}â€¢_while_(Ã—â‰ ) âŸ¨âŸ¨0âŸ©â€¿0âŸ©
â€¢Show mx