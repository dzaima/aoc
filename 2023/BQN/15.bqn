#!/usr/bin/env bqn
âŸ¨SplitâŸ© â† â€¢Import "../../utils/utils.bqn"
l â† ','Split â€¢FChars â‰ â—¶"15.in"â€¿âŠ‘ â€¢args
ht â† {(âŒ½â†‘âŸœğ•©)Â¨ â†•â‰ ğ•©} {256|17Ã—ğ•©}âŸ(â†•1+âŒˆÂ´â‰ Â¨l) 17
ht â€¢internal.SqueezeÂ¨â†© # 1.35ms â†’ 1.17ms; TODO don't

H â† {256| +Â´ ((â‰ ğ•©) âŠ‘ ht) Ã— ğ•©-@}
â€¢Show +Â´ HÂ¨ l

vs â† Â¯1âŠ‘Â¨l           # values
vd â† '-'=vs          # is value deleted here
kt â† (vd-2) â†“Â¨ l     # key text
kn â† âŠkt             # keys as unique numbers
lm â† âˆŠâŒ¾âŒ½kn           # last occurence mask
fv â† ('0'-Ëœlm/vs)âŒ¾((lm/kn)âŠ¸âŠ) Â¯2â¥ŠËœ1+âŒˆÂ´kn # map of key to final value
ktâ€¿knâ€¿vd (Â¬knâˆŠ(lmâˆ§vd)/kn)âŠ¸/Â¨â†© # filter out entries whose last operation is deletion
pm â† âŠ’âŒ¾âŒ½ kn          # progressive counter
pl â† {âŠ‘1âŠËœâŒ½ğ•©}Â¨ knâŠ”vd # progressive counter of last deletion
wi â† â‰[kn,   pm]     # reference index
ti â† â‰[â†•â‰ pl, pl-1]   # target reference index - first entry after last deletion
tm â† wiâˆŠti           # mask of entries at the target

MP â† {ğ•© Ã— 1+â†•â‰ ğ•©} # multiply by position
â€¢Show +Â´ âˆ¾ MP MPÂ¨ (HÂ¨ tm/kt) âŠ” (tm/kn)âŠfv # group values by hashes & compute result
