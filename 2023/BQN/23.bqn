#!/usr/bin/env bqn
âŸ¨Tr, MDSlash, _fx_, InputâŸ© â† â€¢Import "../../utils/utils.bqn"
inp â† >â€¢FLines 2023â€¿23 Input â€¢args
w â† inp='#'
nw â† Â¬w
z â† 0Â¨ inp

{
  u â† (inpâˆŠ"^.") âˆ§ Â»nw
  d â† (inpâˆŠ"v.") âˆ§ Â«nw
  l â† (inpâˆŠ"<.") âˆ§ Â»Ë˜nw
  r â† (inpâˆŠ">.") âˆ§ Â«Ë˜nw
  next â† (<Â¨â†•âˆ˜â‰¢)âŠ¸+ {@âŠ¸â‰¢Â¨âŠ¸/ ğ•©}Â¨ Tr âŸ¨Â¯1â€¿0, 1â€¿0, 0â€¿Â¯1, 0â€¿1âŸ© {âŠ‘âŸœ@â€¿ğ•¨Â¨ ğ•©}Â¨ uâ€¿dâ€¿lâ€¿r
  Run â† { posâ€¿vis:
    u â† 1âŒ¾(posâŠ¸âŠ‘)vis
    @âŠ¸â‰¢Â¨âŠ¸/ {ğ•©âŠ‘vis? @; âŸ¨ğ•©, uâŸ©}Â¨ posâŠ‘next
  }
  
  yE â† Â¯1+â‰ inp
  mx â† 0
  i â† 0
  {
    mxâŒˆâ†© iÃ—âˆ¨Â´ yE = âŠ‘âˆ˜âŠ‘Â¨ ğ•©
    i+â†© 1
    âˆ¾RunÂ¨ ğ•©
  }â€¢_while_{Ã—â‰ ğ•©} âŸ¨{âŸ¨ğ•©, 1âŒ¾(ğ•©âŠ¸âŠ‘)zâŸ©} 0â‹ˆâ‹ˆâ¼/'.'=âŠinpâŸ©
  â€¢Show mx
}

{
  cj â† {ğ•©Ã—2<+Â´âŸ¨Â»ğ•©,Â«ğ•©,Â»Ë˜ğ•©,Â«Ë˜ğ•©âŸ©}nw # conjunctions
  cjâˆ¨â†© nw âˆ§ â†•âŠ¸(=âŸœ0 âˆ¨ âŠ£=Â¯1+âŠ¢) â‰ inp # add in start & end
  cji â† MDSlash cj
  
  sln â† nw âˆ§ Â¬cj # straight line
  cjd â† { # distances between all conjunctions
    cjc â† âˆÂ¨ cji
    i â† 0
    {
      n â† âˆ¨Â´âŸ¨Â»ğ•©,Â«ğ•©,Â»Ë˜ğ•©,Â«Ë˜ğ•©âŸ©
      cjcâŒŠâ†© i+Ã·cjiâŠ‘nâˆ§Â¬ğ•©
      i+â†© 1
      ğ•©âˆ¨slnâˆ§n
    }_fx_â‰¢ 1âŒ¾(ğ•©âŠ¸âŠ‘) z
    cjc
  }Â¨ cji
  
  cjc â† âˆâ‰ cjd
  cjci â† /Â¨ cjc
  cjde â† âˆâŠ¸â‰ âŠ¸/Â¨ cjd
  mx â† 0
  ln â† Â¯1+â‰ cjd
  Run â† { vğ•Šd: # scan all paths through conjunctions
    l  â† Â¯1âŠ‘v
    ns â† lâŠ‘cjci
    ds â† lâŠ‘cjde
    m  â† Â¬nsâˆŠv
    (dÃ—l=ln) âŒˆÂ´ (vâŠ¸âˆ¾Â¨ m/ns) RunÂ¨ d+m/ds
  }
  â€¢Show âŸ¨0âŸ© Run 0
}