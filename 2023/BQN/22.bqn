#!/usr/bin/env bqn
âŸ¨SplitâŸ© â† â€¢Import "../../utils/utils.bqn"
l â† {0â€¿1 + {â€¢ParseFloatÂ¨ ',' Split ğ•©}Â¨ '~' Split ğ•©}Â¨ â€¢FLines â‰ â—¶"22.in"â€¿âŠ‘ â€¢args

{ğ•©!âˆ§Â´<Â´ğ•©}Â¨ l

x0â€¿y0â€¿z0â€¿x1â€¿y1â€¿z1 â† <Ë˜â‰> âˆ¾Â¨ l

di â† {/((2âŠ‘0âŠ‘ğ•©)â‰¥z1) âˆ§ ((0â€¿1âŠ1âŠ‘ğ•©)>x0â€¿y0)âˆ§â—‹(âˆ§Â´)(0â€¿1âŠ0âŠ‘ğ•©)<x1â€¿y1}Â¨ l # which bricks the n'th bridge can depend on
dh â† âŠâŸœ(z1-z0)Â¨ di # the height of the specific dependency
dj â† (â‰ di) â†‘ (âˆ¾ âŠ” (â‰ Â¨ / â†•âˆ˜â‰ )) di # which bricks depend on the n'th bridge

Min â† { diâ€¿dhâ€¿dj ğ•Š updâ€¿zC:
  1 âŠ‘ { ğ•¨ ğ•Š zC:
    r â† ğ•¨âŠ¸({1âŒˆÂ´ (ğ•¨âŠ‘dh) + âŠâŸœzC ğ•¨âŠ‘di}Â¨)âŒ¾(ğ•¨âŠ¸âŠ) ğ•©
    âŸ¨âˆ¾(râ‰ ğ•©)/dj, râŸ©
  }Â´â€¢_while_{Ã—â‰ âŠ‘ğ•©} updâ€¿zC
}
z2 â† diâ€¿dhâ€¿dj Min âŸ¨â†•â‰ di, (âŒˆÂ´z1)Â¨ diâŸ©
â€¢Show (â‰ l) - +Â´âˆŠ âˆ¾ (â†•â‰ z2) {(1=â‰ )âŠ¸/ ((ğ•¨âŠ‘z2) = (ğ•¨âŠ‘dh) + ğ•©âŠz2)/ğ•©}Â¨ di # for each brick, filter its dependencies to those that are directly below it, and report if there's only one such

â€¢Show +Â´ { # for each brick, remove that brick & minimize
  keep â† diâ‰ ğ•©
  +Â´ z2 â‰  âŸ¨keep/Â¨di, keep/Â¨dh, djâŸ© Min âŸ¨ğ•©âŠ‘dj, z2âŸ©
}Â¨ â†•â‰ l