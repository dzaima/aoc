#!/usr/bin/env bqn
âŸ¨SplitF,SplitâŸ© â† â€¢Import "../../utils/utils.bqn"
workflowsâ€¿ratings â† âŸ¨âŸ©SplitF â€¢FLines â‰ â—¶"19.in"â€¿âŠ‘ â€¢args

rkâ€¿rv â† <Ë˜â‰>{
  nameâ€¿restâ†'{' Split ğ•©
  name â‹ˆ {
    condâ€¿next â† ':' Split ğ•©
    gt â† âŠ‘'>'âˆŠcond
    lâ€¿r â† (gtâŠ‘"<>") Split cond
    âŸ¨âŠ‘"xmas"âŠl, gt, â€¢ParseFloat r, {"R": 0; "A": 1; ğ•©} nextâŸ© # alt: (âŠ‘"R"â€¿"A"âŠ<next)âŠ‘0â€¿1â€¿next
  }Â¨ "x<4001:"âŠ¸âˆ¾âŒ¾(Â¯1âŠ¸âŠ‘) ','Split Â¯1â†“rest
}Â¨ workflows



m1 â† rk â€¢HashMap {iâ€¿gtâ€¿constâ€¿next: âŸ¨(i)âŠ¸âŠ‘ (gtâŠ‘<â€¿>){ğ”½} const{ğ”½}, nextâŸ©}Â¨Â¨ rv
in â† m1.Get "in"
Get â† {câ€¿râ†âŠ‘lâ†ğ•¨ â‹„ aâ†ğ•© â‹„ {Â¬C a? (1â†“l) Get a; 0==r? r; (m1.Get r) Get a}}
â€¢Show +Â´ {+Â´inâŠ¸GetâŠ¸Ã— â€¢ParseFloatÂ¨ 2â†“Â¨','Split Â¯1â†“1â†“ğ•©}Â¨ ratings



m2 â† rk â€¢HashMap rv
# done â† â€¢HashMapËœâŸ¨âŸ© # caching isn't beneficial
all â† âŸ¨1â€¿1â€¿1â€¿1, 4001â€¿4001â€¿4001â€¿4001âŸ©
Do â† {
  # done.Has ğ•©? done.Get ğ•©;
  And  â† {ğ•¨ğ•Šiâ€¿gtâ€¿câ€¿Â·: {gt? ğ•©âŒˆ1+c; ğ•©âŒŠc}âŒ¾(iâŠ‘(Â¬gt)âŠ‘âŠ¢) ğ•¨}
  AndN â† {ğ•¨ğ•Šiâ€¿gtâ€¿câ€¿Â·: {gt? ğ•©âŒŠ1+c; ğ•©âŒˆc}âŒ¾(iâŠ‘  gt âŠ‘âŠ¢) ğ•¨}
  res â† âˆ¾{Â¯1â†“â†‘ğ•©}âŠ¸({0â‰¡3âŠ‘ğ•©? âŸ¨âŸ©; 1â‰¡3âŠ‘ğ•©? âŸ¨(all And ğ•©) AndNËœÂ´âŒ½ ğ•¨âŸ©; (âŠ¢ AndNËœÂ´âŸœâŒ½ ğ•¨Ë™)Â¨ AndâŸœğ•©Â¨ Do 3âŠ‘ğ•©}Â¨) m2.Get ğ•©
  # ğ•© done.Set res
  res
}

â€¢Show +Â´{Ã—Â´-Â´âŒ½ğ•©}Â¨ Do "in"