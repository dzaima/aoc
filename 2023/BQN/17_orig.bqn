#!/usr/bin/env bqn
âŸ¨InputâŸ© â† â€¢Import "../../utils/utils.bqn"
l â† '0'-Ëœ>â€¢FLines 2023â€¿17 Input â€¢args
n â† â‰ l

{ ğ•Š jminâ€¿jmax:
  jmask â† jminâ‰¤â†•jmax
  ls â† âŸ¨0,0âŸ©
  ns â† âŸ¨0â€¿0â€¿0â€¿@,3â€¿0â€¿0â€¿@âŸ©
  todo â† (4âˆ¾â‰¢l)â¥Š1
  path â† (4âˆ¾â‰¢l)â¥Š@

  deltas â† âŸ¨Â¯1â€¿0, 0â€¿1, 1â€¿0, 0â€¿Â¯1âŸ©
  res â† âˆ
  Step â† { ğ•Š:
    min â† âŠ‘âŒŠÂ´âŠ¸(âŠËœ)ls
    k â† 3â†‘dirâ€¿yâ€¿xâ€¿k0 â† minâŠ‘ns
    len â† minâŠ‘ls
    ls â†© (minâ†‘ls)âˆ¾(min+1)â†“ls
    ns â†© (minâ†‘ns)âˆ¾(min+1)â†“ns
    kâŠ‘todo?
    {ğ•Š: resâŒŠâ†©len}âŸâŠ¢ yâ€¿xâ‰¡Â¯1+â‰¢l
    todo 0âŒ¾(dirâ€¿yâ€¿xâŠ¸âŠ‘)â†©
    # path k0âŒ¾(kâŠ¸âŠ‘)âŸ(kâ‰¢@)â†©
    {
      # p â† ((0â‰¤âŒŠÂ´Â¨)âˆ§n>âŒˆÂ´Â¨)âŠ¸/ (yâ€¿x+(ğ•©âŠ‘deltas)Ã—âŠ¢)Â¨ 1+â†•3
      # p â† (yâ€¿x+(ğ•©âŠ‘deltas)Ã—âŠ¢)Â¨ 1+â†•3âŒŠğ•©âŠ‘âŸ¨y,n-x+1,n-y+1,xâŸ©
      p â† (yâ€¿x+(ğ•©âŠ‘deltas)Ã—âŠ¢)Â¨ 1+â†•jmaxâŒŠğ•©âŠ‘âŸ¨y,n-x+1,n-y+1,xâŸ©
      # p!âˆ§Â´ ((0â‰¤âŒŠÂ´Â¨)âˆ§n>âŒˆÂ´Â¨)p
      pâ‰¢âŸ¨âŸ©?
      k2 â† ğ•©âˆ¾Â¨p
      m â† (k2âŠ‘todo) âˆ§ (â‰ p)â†‘jmask
      # lsâˆ¾â†© len + m/+`pâŠ‘l
      lsâˆ¾â†© Ã—âˆ˜â‰ â—¶âŸ¨â†•0,â€¢internal.SqueezeâŸ© len + m/+`pâŠ‘l
      nsâˆ¾â†© (m/k2)âˆ¾Â¨<<k
      ;âŸ¨âŸ©
    }Â¨ 4|dir+1â€¿3
    ;@
  }

  Stepâ€¢_while_{ğ•Š: 0â‰ â‰ ls} @
  â€¢Show res
}Â¨ âŸ¨0â€¿3, 3â€¿10âŸ©
# â€¢ShowÂ¨ <Ë˜path
# StepâŸ10000 @
# â€¢Show ls
# â€¢Show â‰ ns

# pu â† {{ğ•©âˆ¾<(Â¯1âŠ‘ğ•©)âŠ‘path}â€¢_while_{@â‰¢Â¯1âŠ‘ğ•©} â‹ˆğ•©âˆ¾Â¯1+â‰¢l}Â¨ 1â€¿2
# â€¢ShowÂ¨ {'#'Â¨âŒ¾((Â¯1â†“1â†“Â¨ğ•©)âŠ¸âŠ‘) 'Â·'Â¨l}Â¨pu

