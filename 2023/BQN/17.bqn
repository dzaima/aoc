#!/usr/bin/env bqn
l â† '0'-Ëœ>â€¢FLines â‰ â—¶"17.in"â€¿âŠ‘ â€¢args
n â† â‰ l

{ ğ•Š jminâ€¿jmax:
  jmask â† jminâ‰¤â†•jmax
  ls â† âŸ¨0,0âŸ©
  is â† 0â€¿1 â‹„ isCâ†2
  ns â† is â€¢HashMap âŸ¨0â€¿0â€¿0,3â€¿0â€¿0âŸ©
  todo â† (4âˆ¾â‰¢l)â¥Š1
  
  deltas â† âŸ¨Â¯1â€¿0, 0â€¿1, 1â€¿0, 0â€¿Â¯1âŸ©
  res â† âˆ
  Step â† { ğ•Š:
    min â† âŠ‘âŒŠÂ´âŠ¸(âŠËœ)ls
    k â† dirâ€¿yâ€¿x â† ns.Get mkâ†minâŠ‘is
    len â† minâŠ‘ls
    ls â†© (minâ†‘ls)âˆ¾(min+1)â†“ls
    is â†© (minâ†‘is)âˆ¾(min+1)â†“is
    ns.Delete mk
    kâŠ‘todo?
    {ğ•Š: resâŒŠâ†©len}âŸâŠ¢ yâ€¿xâ‰¡Â¯1+â‰¢l
    todo 0âŒ¾(dirâ€¿yâ€¿xâŠ¸âŠ‘)â†©
    {
      p â† (yâ€¿x+(ğ•©âŠ‘deltas)Ã—âŠ¢)Â¨ 1+â†•jmaxâŒŠğ•©âŠ‘âŸ¨y,n-x+1,n-y+1,xâŸ©
      pâ‰¢âŸ¨âŸ©?
      k2 â† ğ•©âˆ¾Â¨p
      m â† (k2âŠ‘todo) âˆ§ (â‰ p)â†‘jmask
      vs â† m/k2
      lsâˆ¾â†© Ã—âˆ˜â‰ â—¶âŸ¨â†•0,â€¢internal.SqueezeâŸ© len + m/+`pâŠ‘l
      ks â† isC+â†•â‰ vs
      isâˆ¾â†© ks
      ks ns.SetÂ¨ vs
      isC+â†© â‰ vs
      
      ;âŸ¨âŸ©
    }Â¨ 4|dir+1â€¿3
    ;@
  }

  Stepâ€¢_while_{ğ•Š: 0â‰ â‰ ls} @
  â€¢Show res
}Â¨ âŸ¨0â€¿3, 3â€¿10âŸ©
