#!/usr/bin/env bqn
âŸ¨RB, B10, Num, Repr, LCM, GCD, Ints, SInts, Split, SplitF, ReIndex, MDSlash, MDSlashI, Unjoin, Count, _fx_, _fi_, Tr, InputâŸ© â† â€¢Import "../../utils/utils.bqn"
l â† {<Ë˜2â€¿3â¥ŠSInts ğ•©}Â¨ â€¢FLines 2023â€¿24 Input â€¢args
# l â†© {{â€¢ParseFloatÂ¨ ','Splitğ•©}Â¨ '@'Split ' 'âŠ¸â‰ âŠ¸/ ğ•©}Â¨ â€¢FLines 2023â€¿24 Input â€¢args
xâ€¿yâ€¿zâ€¿vxâ€¿vyâ€¿vz â† Tr âˆ¾Â¨l
x2â€¿y2â€¿z2 â† xâ€¿yâ€¿z + vxâ€¿vyâ€¿vz
b0â€¿b1 â† 200000000000000â€¿400000000000000
{ğ•Š:b0â€¿b1 â†© 7â€¿27}âŸâŠ¢ 5=â‰ l

Cr â† { x1â€¿y1â€¿x2â€¿y2â€¿x3â€¿y3â€¿x4â€¿y4:
  # px â† ((((x1Ã—y2)-y1Ã—x2)Ã—(x3-x4)) - (x1-x2)Ã—((x3Ã—y4)-(y3Ã—x4))) Ã· ((x1-x2)Ã—(y3-y4)) - (y1-y2)Ã—(x3-x4)
  # py â† ((((x1Ã—y2)-y1Ã—x2)Ã—(y3-y4)) - (y1-y2)Ã—((x3Ã—y4)-(y3Ã—x4))) Ã· ((x1-x2)Ã—(y3-y4)) - (y1-y2)Ã—(x3-x4)
  # pxâ€¿py
  vx1 â† x2-x1
  vy1 â† y2-y1
  vx3 â† x4-x3
  vy3 â† y4-y3
  # ax + c
  # bx + d
  s1 â† vy1Ã·vx1
  s3 â† vy3Ã·vx3
  o1 â† y1 - x1Ã—s1
  o3 â† y3 - x3Ã—s3
  px â† (o1-o3)Ã·s3-s1
  py â† o1 + s1 Ã— px
  pxâ€¿py
}
â€¢Show +Â´â¥Š {>âŒœËœâ†•â‰ ğ•©}âŠ¸Ã—> {âŸ¨x3â€¿y3â€¿z3, vx3â€¿vy3â€¿vz3âŸ©:
  x4â€¿y4â€¿z4 â† x3â€¿y3â€¿z3 + vx3â€¿vy3â€¿vz3
  pxâ€¿py â† Cr xâ€¿yâ€¿x2â€¿y2â€¿x3â€¿y3â€¿x4â€¿y4
  # â€¢Show (px-x )Ã·vx
  # â€¢Show (px-x3)Ã·vx3
  b â† âˆ§Â´(pxâ€¿pyâ‰¥b0) âˆ§ pxâ€¿pyâ‰¤b1
  bâˆ§â†© 0 â‰¤ (px-x) Ã· vx
  bâˆ§â†© 0 â‰¤ (px-x3) Ã· vx3
  # â€¢Out "--------"
  # â€¢Show >âŒŠxâ€¿px
  # â€¢Show >âŒŠyâ€¿py
  # â€¢Show 0 â‰¤ (py-y) Ã· vy
  # â€¢Show 0 â‰¤ (py-y3) Ã· vy3
  # â€¢Show 0 â‰¤ (px-x) Ã· vx
  # â€¢Show 0 â‰¤ (px-x3) Ã· vx3
  # {â€¢Show ğ•©â‹ˆx3}âŸ(Ã—â‰ ) x /Ëœ b âˆ§ Â¬ (0 â‰¤ (px-x) Ã· vx) âˆ§ (0 â‰¤ (px-x3) Ã· vx3)
  # pr â† =Â´vxâ€¿vyÃ·vx3â€¿vy3
  # bâˆ§â†© Â¬pr
  # pr â† (vy3Ã—vx) = vx3Ã—vy
  # â€¢Show /pr âˆ§ =Â´ (x3â€¿y3-xâ€¿y)Ã·vxâ€¿vy
  # â€¢Show (pxâˆŠâˆâ€¿Â¯âˆ)âŠ¸/b
  # bâˆ¨â†© pr âˆ§ (pxâ‰ px) âˆ§ âˆ¨Â´ {{âˆ§Â´(ğ•©â‰¥b0)âˆ§ğ•©â‰¤b1} Cr ğ•©âˆ¾âŸ¨x3,y3,x4,y4âŸ©}Â¨ âŸ¨b0â€¿b0â€¿b0â€¿b1, b0â€¿b0â€¿b1â€¿b0, b1â€¿b0â€¿b1â€¿b1, b0â€¿b1â€¿b1â€¿b1âŸ©
  # â€¢Show pxâˆŠâˆâ€¿Â¯âˆ
  # bâˆ¨â†© pxâ‰ px
  # â€¢Show >pxâ€¿pyâ€¿pr
  # â€¢Show >pxâ€¿pyâ€¿(((px=x ) âˆ¨ (Ã—vx ) = Ã—px-x) âˆ§ (px=x3) âˆ¨ (Ã—vx3) = Ã—px-x3)â€¿(Â¬=Â´vxâ€¿vyÃ·vx3â€¿vy3)
  # â€¢Show b
  b
}Â¨ l
# 14042 low
# 14045 wrong
# 28084 high


âŸ¨newreplâŸ© â† â€¢Import"path/to/bqn-smt/bitwuzla.bqn" # https://codeberg.org/dzaima/bqn-smt
r â† Newrepl @
(r.REPLExec "lâ†@ â‹„ {lâ†©ğ•©}") {ğ•ğ•©} 4â†‘l

r.REPLExec "

r0 â† I64Â¨ ""xyz""
rv â† I64Â¨ 'v'âˆ¾Â¨ ""xyz""

Sat {âŸ¨c0,cvâŸ©: tâ†I64@ â‹„ âˆ§Â´ (r0 + tÃ—rv) = c0 + tÃ—cv}Â¨ l
â€¢Show +Â´ EvalToBQNÂ¨ FindÂ¨ r0
"