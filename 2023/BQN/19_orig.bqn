#!/usr/bin/env bqn
âŸ¨SplitF,SplitâŸ© â† â€¢Import "../../utils/utils.bqn"
aâ€¿b â† âŸ¨âŸ©SplitF â€¢FLines â‰ â—¶"19.in"â€¿âŠ‘ â€¢args

rules â† {
  nâ€¿râ†'{' Split ğ•©
  n â‹ˆ {
    câ€¿tâ†':'Splitğ•©
    m â† â‹ˆâ¼"<>"(âˆŠ/âŠ£)c
    lâ€¿r â† m Split c
    âŸ¨(âŠ‘lâŠËœ"xmas")âŠ¸âŠ‘ ((âŠ‘mâŠËœ"<>")âŠ‘<â€¿>){ğ”½} (â€¢ParseFloat r){ğ”½}, tâŸ©
  }Â¨âŒ¾(Â¯1â†“âŠ¢) {1â€¿ğ•©}âŒ¾(Â¯1âŠ¸âŠ‘) ','Split Â¯1â†“r
}Â¨ a

rm â† â€¢HashMapË â‰>rules
r0 â† rm.Get "in"
Get â† {câ€¿râ†âŠ‘lâ†ğ•¨ â‹„ aâ†ğ•© â‹„ {C a? {1=â‰ r? râ‰¡"A"; (rm.Get r) Get a}; (1â†“l) Get a}}
â€¢Show +Â´+Â´Â¨{{r0 Get ğ•©}âŠ¸Ã— â€¢ParseFloatÂ¨ 2â†“Â¨','Split Â¯1â†“1â†“ğ•©}Â¨ b


rules2 â† {
  nâ€¿râ†'{' Split ğ•©
  n â‹ˆ {
    câ€¿tâ†':'Splitğ•©
    m â† â‹ˆâ¼"<>"(âˆŠ/âŠ£)c
    lâ€¿r â† m Split c
    âŸ¨âŠ‘lâŠËœ"xmas", (âŠ‘mâŠËœ"<>")âŠ‘"<>", â€¢ParseFloat r, tâŸ©
  }Â¨âŒ¾(Â¯1â†“âŠ¢) {0â€¿'<'â€¿4001â€¿ğ•©}âŒ¾(Â¯1âŠ¸âŠ‘) ','Split Â¯1â†“r
}Â¨ a

rm â†© â€¢HashMapË â‰>rules2

done â† â€¢HashMapËœâŸ¨âŸ©

all â† âŸ¨1â€¿1â€¿1â€¿1, 4001â€¿4001â€¿4001â€¿4001âŸ©
Do â† {
  done.Has ğ•©? done.Get ğ•©;
  ğ•© done.Set @
  And â† {
    iâ€¿oâ€¿câ€¿Â· â† ğ•¨
    {oâ‰¡'>'? (1+c)âŒˆğ•©; câŒŠğ•©}âŒ¾(iâŠ‘{oâ‰¡'>'?0;1}âŠ‘âŠ¢) ğ•©
  }
  AndN â† {
    iâ€¿oâ€¿câ€¿Â· â† ğ•©
    {oâ‰¡'<'? câŒˆğ•©; (c+1)âŒŠğ•©}âŒ¾(iâŠ‘{oâ‰¡'>'?1;0}âŠ‘âŠ¢) ğ•¨
  }
  res â† âˆ¾{Â¯1â†“â†‘ğ•©}âŠ¸({"R"â‰¡3âŠ‘ğ•©? âŸ¨âŸ©; "A"â‰¡3âŠ‘ğ•©? âŸ¨(ğ•© And all) AndNËœÂ´âŒ½ ğ•¨âŸ©; (âŠ¢ AndNËœÂ´âŸœâŒ½ ğ•¨Ë™)Â¨ ğ•©âŠ¸AndÂ¨ Do 3âŠ‘ğ•©}Â¨) rm.Get ğ•©
  ğ•© done.Set res
  res
}

â€¢Show +Â´{Ã—Â´-Â´âŒ½ğ•©}Â¨ Do "in"