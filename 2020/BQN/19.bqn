#!/usr/bin/env bqn
âŸ¨Num, Ints, SplitF, SplitâŸ© â† â€¢Import "../../utils/utils.bqn"
rules0â€¿messages â† âŸ¨âŸ© SplitF â€¢FLines â‰ â—¶"19.in"â€¿âŠ‘ â€¢args

r â† {
  nâ€¿v â† (âŠ‘ğ•©âŠ':')(â†‘â‹ˆ2âŠ¸+âŠ¸â†“)ğ•©
  {
    '"'=âŠ‘v? âŸ¨Num n, âŠ‘1â†“Â¯1â†“vâŸ©;
    âŸ¨Num n, IntsÂ¨ '|'Split vâŸ©
  }
}Â¨ rules0

rl â† 1=âˆ˜âŠ‘Â¨r # rules with list
[rn,ra] â† â‰>r # rule name, arguments

rm â† raâŒ¾(rnâŠ¸âŠ) @â¥ŠËœ1+âŒˆÂ´rn # map from rule name to argument

Get â† {vâ†ğ•©âŠ‘rm â‹„ {=v? âˆ¾ (â¥ŠÂ·âˆ¾âŒœÂ´ GetÂ¨)Â¨ v; â‹ˆâ‹ˆv}}
# â€¢Show +Â´(Get 0)âˆŠmessages # initial p1 impl; slower than using p2's method

! âŸ¨8â€¿11âŸ© â‰¡ 0âŠ‘rm # assumption 1: "0: 8 11" rule

# 0: 8 11              # said assumption
# 8: 42 | 42 8         # given
# 11: 42 31 | 42 11 31 # given

# 8: 42*w           # wâ‰¥1
# 11: 42*y 31*y     # yâ‰¥1
# 0: 42*w 42*y 31*y
# 0: 42*x 31*y      # xâ‰¥y+1; , xâ‰¥2

ox â† Get 42
oy â† Get 31

gl â† â‰ âŠ‘ox # group length
! {âˆ§Â´ âˆ§Â´Â¨ gl = â‰ Â¨Â¨ğ•©} oxâ€¿oy # assumption 2: variations for 42 and 31 all have the same length

ox >â†©
oy >â†©

messages (0=gl|â‰ Â¨)âŠ¸/ â†© # not required for my input (and probably everyone else's), but not much more difficult to do than an assuption

Unjoin â† {((â‰ Â¨ğ•¨)/â†•â‰ ğ•¨) âŠ” ğ•©} # TODO âŒ¾âˆ¾

mgs â† âˆ˜â€¿glâŠ¸â¥ŠÂ¨ messages # message groups
mx â† mgs Unjoin ox âˆŠËœ âˆ¾mgs # message group has x
my â† mgs Unjoin oy âˆŠËœ âˆ¾mgs # message group has y
v â† my {nxâ†+Â´âˆ§`ğ•© â‹„ nyâ†+Â´âˆ§`âŒ½ğ•¨ â‹„ (nxâ‰¥2) âˆ§ (nyâ‰¥1) âˆ§ (nxâ‰¥ny+1) âˆ§ (nx+ny)â‰¥â‰ ğ•©}Â¨ mx

â€¢Show +Â´ my{3=â‰ ğ•©? (âˆ§Â´2â†‘ğ•©) âˆ§ 2âŠ‘ğ•¨;0}Â¨mx # part 1: 42 42 31
â€¢Show +Â´ v # part 2