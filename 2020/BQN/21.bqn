#!/usr/bin/env cbqn
âŸ¨SplitâŸ© â† â€¢Import "utils.bqn"
l â† â€¢FLines â‰ â—¶"21.in"â€¿âŠ‘ â€¢args
[is0,as0] â† â‰>{' 'Splitğ•©}â€¿{1â†“Â¨','Split Â¯1â†“8â†“ğ•©}âŠ¸({ğ•ğ•©}Â¨)Â¨ '(' SplitÂ¨ l # ingredients, allergens

ins â† â·âˆ¾is0 # ingredient names
ans â† â·âˆ¾as0 # allergen names

is â† insâŠ¸âŠâŒ¾âˆ¾ is0 # ingredient indexes instead of names
as â† ansâŠ¸âŠâŒ¾âˆ¾ as0 # allergen indexes instead of names

ip â† (â‰ ins) â†‘âŸœ(/â¼)Â¨ is # for each food, whether each ingredient is present
aw â† {(âˆ¾ğ•©)âŠ”/â‰ Â¨ğ•©} as # which food each allergen is present in

ao â† (âˆ§Â´âŠâŸœip)Â¨ aw # for each allergen, which ingredients it could be in
# â€¢Show âŸ¨>ip, â‰Ë˜aw, >aoâŸ©

ic â† /â¼âˆ¾is # ingredient counts
ok â† âˆ¨Â´ao # ingredients which may contain allergens
â€¢Show +Â´(Â¬ok)/ic

ao2 â† okâŠ¸/Â¨ ao # filter out the impossible ingredient options
ao2to1 â† /ok # the ao-index for each ao2
where â† /Â¨ <Ë˜â‰>ao2 # which food potentially is each allergen
done â† 0Â¨âŠ‘ao2 # which foods are completed; mutated
count â† +Â´Â¨ ao2 # count of possible allergens for each food; mutated
a2i â† â‹âŠ¸âŠËâ‰>{ğ•Š:
  n â† âŠ‘countâŠ1 # allergen with only one ingredient option left
  m â† (Â¬done)âˆ§nâŠ‘ao2 # mask of that only ingredient
  i â† â‹ˆâ¼ / m # and its index
  count -âŸœ1âŒ¾((iâŠ‘where)âŠ¸âŠ)â†©
  doneâˆ¨â†© m
  nâ€¿i
}Â¨ â†•â‰ count

â€¢Out {ğ•¨âˆ¾','âˆ¾ğ•©}Â´ ans â‹âŠ¸âŠ (a2iâŠao2to1)âŠins