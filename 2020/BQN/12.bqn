#!/usr/bin/env cbqn
âŸ¨IntsâŸ© â† â€¢Import "../../utils/utils.bqn"
l â† â€¢FChars â‰ â—¶"12.in"â€¿âŠ‘ â€¢args

cNâ€¿cSâ€¿cEâ€¿cWâ€¿cLâ€¿cRâ€¿cF â† â†•7
cmd â† {(â‰ ğ•©)âŠ¸â‰ âŠ¸/ ğ•©âŠl} "NSEWLRF"
am â† Ints l

go â† (cmd=cF) âˆ¨ cmdâ‰¤cW
constRot â† cNâ€¿cEâ€¿cSâ€¿cWâŠcmd
varRot â† 4|+`90Ã·Ëœ(amÃ—cmd=cR)-amÃ—cmd=cL

isFwd   â† cmd=cF
isConst â† cmdâ‰¤cW

rd â† âŸ¨0â€¿Â¯1, 1â€¿0, 0â€¿1, Â¯1â€¿0âŸ©

#    -y
#     N
# -x W E +x
#     S
#    +y

{
  rot â† (isFwdÃ—4|1+varRot) + constRotÃ—isConst
  â€¢Show +Â´| +Â´ rdÃ—+Â´Â¨ 4â†‘rotâŠ”amÃ—go
}

{
  rdx â† 0âŠ‘Â¨rd
  rdy â† 1âŠ‘Â¨rd
  
  wpRot â† 4|constRot-varRot # direction of north
  
  mvWp â† amÃ—isConst
  wpVX â† 10+`mvWp Ã— wpRotâŠrdx # virtual waypoint position, as if there were no rotations
  wpVY â† Â¯1+`mvWp Ã— wpRotâŠrdy
  
  mvShop â† amÃ—isFwd
  dVX â† mvShopÃ—wpVX # delta position pre-unrotation
  dVY â† mvShopÃ—wpVY
  
  unrotN â† 4|2-varRot
  unrotE â† 4|1-varRot
  fx â† +Â´+Â´âŸ¨unrotNâŠrdx, unrotNâŠrdyâŸ©Ã—dVXâ€¿dVY
  fy â† +Â´+Â´âŸ¨unrotEâŠrdx, unrotEâŠrdyâŸ©Ã—dVXâ€¿dVY
  â€¢Show fx+â—‹|fy
}