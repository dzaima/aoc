#!/usr/bin/env cbqn
âŸ¨Num, SplitFâŸ© â† â€¢Import "../../utils/utils.bqn"
l â† '0'-ËœÂ¯1+â€¢FChars â‰ â—¶"23.in"â€¿âŠ‘ â€¢args

F â† {
  m â† (â‹ğ•©)âŠ1âŒ½ğ•© # map from number to next
  t â† â‰ m
  Step â† {
    p â† âŠ‘âŸœmâŸ(1+â†•4) ğ•©  # picked up, plus a 4th element
    m (3âŠ‘p)âŒ¾(ğ•©âŠ¸âŠ‘)â†©    # remove the picked up from the map
    d â† {(t|-âŸœ1)â€¢_while_{ğ•Š:âŠ‘ğ•©âˆŠ3â†‘p} t|ğ•©}âŸ((<âŸœ0) âˆ¨Â´ p=âŠ¢) ğ•©-1 # destination; âˆ¨Â´p=âŠ¢ overestimates, but we don't care
    dn â† dâŠ‘m          # after destination
    m (âŠ‘p)âŒ¾(dâŠ¸âŠ‘)â†©     # inset picked up
    m (dn)âŒ¾((2âŠ‘p)âŠ¸âŠ‘)â†© # and end picked up at dn
    ğ•©âŠ‘m               # next value
  }
  StepâŸğ•¨ âŠ‘ğ•©
  m
}

â€¢Out '1'+âŠ‘âŸœ(100 F l)âŸ(1â†“â†•â‰ l) 0
â€¢Show Ã—Â´1+{âŠ‘âŸœğ•©âŸ1â€¿2 0} 10e6 F lâˆ¾(â‰ l)â†“â†•1e6
